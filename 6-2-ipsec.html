<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="IPSec Deep Dive - Complete guide to IPSec VPN including IKE phases, ESP, AH, encryption algorithms, and troubleshooting">
    <title>IPSec Deep Dive | Network Security Guide</title>
    <link rel="stylesheet" href="main.css">
    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>ğŸ”’</text></svg>">
</head>
<body>
    <div class="app-container">
        <!-- Sidebar Navigation -->
        <aside class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <a href="index.html" class="sidebar-logo">
                    <div class="sidebar-logo-icon">ğŸ”’</div>
                    <div class="sidebar-logo-text">Network Security<span>Ultimate Guide</span></div>
                </a>
            </div>
            <div class="sidebar-search">
                <input type="text" id="searchInput" placeholder="Search... (Ctrl+K)" autocomplete="off">
            </div>
            <nav class="sidebar-nav" id="sidebarNav">
                <!-- Section 1: Networking Fundamentals -->
                <div class="nav-section">
                    <div class="nav-section-header" onclick="toggleSection(this)">
                        <div class="nav-section-title"><span class="nav-section-icon">ğŸŒ</span>Networking Fundamentals</div>
                        <span class="nav-section-toggle">â–¼</span>
                    </div>
                    <div class="nav-section-content">
                        <a href="1-1-osi-model.html" class="nav-link"><span class="nav-link-number">1.1</span> OSI Model</a>
                        <a href="1-2-tcpip.html" class="nav-link"><span class="nav-link-number">1.2</span> TCP/IP Networking</a>
                        <a href="1-3-ip-addressing.html" class="nav-link"><span class="nav-link-number">1.3</span> IP Addressing & Subnetting</a>
                        <a href="1-4-dns.html" class="nav-link"><span class="nav-link-number">1.4</span> DNS</a>
                        <a href="1-5-routing.html" class="nav-link"><span class="nav-link-number">1.5</span> Routing Protocols</a>
                        <a href="1-6-switching.html" class="nav-link"><span class="nav-link-number">1.6</span> Switching & VLANs</a>
                        <a href="1-7-dns-security.html" class="nav-link"><span class="nav-link-number">1.7</span> DNS Security</a>
                        <a href="1-8-wireless-security.html" class="nav-link"><span class="nav-link-number">1.8</span> Wireless Security</a>
                        <a href="1-9-bgp-security.html" class="nav-link"><span class="nav-link-number">1.9</span> BGP Security</a>
                        <a href="1-10-layer2-security.html" class="nav-link"><span class="nav-link-number">1.10</span> Layer 2 Security</a>
                        <a href="1-11-snmp-security.html" class="nav-link"><span class="nav-link-number">1.11</span> SNMP Security</a>
                        <a href="1-12-aaa-radius-tacacs.html" class="nav-link"><span class="nav-link-number">1.12</span> AAA / RADIUS / TACACS+</a>
                        <a href="1-13-ipv6-security.html" class="nav-link"><span class="nav-link-number">1.13</span> IPv6 Security</a>
                        <a href="1-14-macsec.html" class="nav-link"><span class="nav-link-number">1.14</span> MACsec</a>
                        <a href="1-15-network-taps.html" class="nav-link"><span class="nav-link-number">1.15</span> Network TAPs & Visibility</a>
                        <a href="1-16-doh-dot.html" class="nav-link"><span class="nav-link-number">1.16</span> DoH/DoT Security</a>
                    </div>
                </div>

                <!-- Section 2: Firewalls -->
                <div class="nav-section">
                    <div class="nav-section-header" onclick="toggleSection(this)">
                        <div class="nav-section-title"><span class="nav-section-icon">ğŸ”¥</span>Firewalls</div>
                        <span class="nav-section-toggle">â–¼</span>
                    </div>
                    <div class="nav-section-content">
                        <a href="2-1-firewall-fundamentals.html" class="nav-link"><span class="nav-link-number">2.1</span> Firewall Fundamentals</a>
                        <a href="2-4-palo-alto.html" class="nav-link"><span class="nav-link-number">2.4</span> Palo Alto Networks</a>
                        <a href="2-5-cisco-firepower.html" class="nav-link"><span class="nav-link-number">2.5</span> Cisco Firepower/ASA</a>
                        <a href="2-6-fortigate.html" class="nav-link"><span class="nav-link-number">2.6</span> Fortinet FortiGate</a>
                        <a href="2-7-checkpoint.html" class="nav-link"><span class="nav-link-number">2.7</span> Check Point</a>
                        <a href="2-8-cloud-firewalls.html" class="nav-link"><span class="nav-link-number">2.8</span> Cloud Firewalls</a>
                        <a href="2-9-firewall-ha.html" class="nav-link"><span class="nav-link-number">2.9</span> High Availability</a>
                        <a href="2-10-firewall-logging.html" class="nav-link"><span class="nav-link-number">2.10</span> Firewall Logging</a>
                        <a href="2-11-firewall-troubleshooting.html" class="nav-link"><span class="nav-link-number">2.11</span> Troubleshooting</a>
                        <a href="2-12-ddos-protection.html" class="nav-link"><span class="nav-link-number">2.12</span> DDoS Protection</a>
                    </div>
                </div>

                <!-- Section 3: Web Proxy -->
                <div class="nav-section">
                    <div class="nav-section-header" onclick="toggleSection(this)">
                        <div class="nav-section-title"><span class="nav-section-icon">ğŸŒ</span>Web Proxy & TLS</div>
                        <span class="nav-section-toggle">â–¼</span>
                    </div>
                    <div class="nav-section-content">
                        <a href="3-1-proxy-fundamentals.html" class="nav-link"><span class="nav-link-number">3.1</span> Proxy Fundamentals</a>
                        <a href="3-2-ssl-inspection.html" class="nav-link"><span class="nav-link-number">3.2</span> SSL/TLS Inspection</a>
                        <a href="3-3-url-filtering.html" class="nav-link"><span class="nav-link-number">3.3</span> URL Filtering</a>
                        <a href="3-4-squid.html" class="nav-link"><span class="nav-link-number">3.4</span> Squid Proxy</a>
                        <a href="3-5-tls-hardening.html" class="nav-link"><span class="nav-link-number">3.5</span> TLS Hardening</a>
                    </div>
                </div>

                <!-- Section 4: WAF & API Security -->
                <div class="nav-section">
                    <div class="nav-section-header" onclick="toggleSection(this)">
                        <div class="nav-section-title"><span class="nav-section-icon">ğŸ›¡ï¸</span>WAF & API Security</div>
                        <span class="nav-section-toggle">â–¼</span>
                    </div>
                    <div class="nav-section-content">
                        <a href="4-1-waf-fundamentals.html" class="nav-link"><span class="nav-link-number">4.1</span> WAF Fundamentals</a>
                        <a href="4-2-owasp-top10.html" class="nav-link"><span class="nav-link-number">4.2</span> OWASP Top 10</a>
                        <a href="4-3-aws-waf.html" class="nav-link"><span class="nav-link-number">4.3</span> AWS WAF</a>
                        <a href="4-4-azure-waf.html" class="nav-link"><span class="nav-link-number">4.4</span> Azure WAF</a>
                        <a href="4-5-cloudflare-waf.html" class="nav-link"><span class="nav-link-number">4.5</span> Cloudflare WAF</a>
                        <a href="4-6-api-security.html" class="nav-link"><span class="nav-link-number">4.6</span> API Security</a>
                    </div>
                </div>

                <!-- Section 5: IDS/IPS & NDR -->
                <div class="nav-section">
                    <div class="nav-section-header" onclick="toggleSection(this)">
                        <div class="nav-section-title"><span class="nav-section-icon">ğŸš¨</span>IDS/IPS & NDR</div>
                        <span class="nav-section-toggle">â–¼</span>
                    </div>
                    <div class="nav-section-content">
                        <a href="5-1-ids-ips-fundamentals.html" class="nav-link"><span class="nav-link-number">5.1</span> IDS/IPS Fundamentals</a>
                        <a href="5-2-snort-suricata.html" class="nav-link"><span class="nav-link-number">5.2</span> Snort & Suricata</a>
                        <a href="5-3-zeek.html" class="nav-link"><span class="nav-link-number">5.3</span> Zeek (Bro)</a>
                        <a href="5-4-ids-tuning.html" class="nav-link"><span class="nav-link-number">5.4</span> IDS/IPS Tuning</a>
                        <a href="5-5-ndr.html" class="nav-link"><span class="nav-link-number">5.5</span> Network Detection & Response</a>
                    </div>
                </div>

                <!-- Section 6: VPN & WAN -->
                <div class="nav-section">
                    <div class="nav-section-header" onclick="toggleSection(this)">
                        <div class="nav-section-title"><span class="nav-section-icon">ğŸ”</span>VPN & SD-WAN</div>
                        <span class="nav-section-toggle">â–¼</span>
                    </div>
                    <div class="nav-section-content">
                        <a href="6-1-vpn-fundamentals.html" class="nav-link"><span class="nav-link-number">6.1</span> VPN Fundamentals</a>
                        <a href="6-2-ipsec.html" class="nav-link"><span class="nav-link-number">6.2</span> IPSec Deep Dive</a>
                        <a href="6-3-ssl-vpn.html" class="nav-link"><span class="nav-link-number">6.3</span> SSL VPN</a>
                        <a href="6-4-site-to-site.html" class="nav-link"><span class="nav-link-number">6.4</span> Site-to-Site VPN</a>
                        <a href="6-5-vpn-troubleshooting.html" class="nav-link"><span class="nav-link-number">6.5</span> VPN Troubleshooting</a>
                        <a href="6-6-sdwan-security.html" class="nav-link"><span class="nav-link-number">6.6</span> SD-WAN Security</a>
                    </div>
                </div>

                <!-- Section 7: Network Architecture -->
                <div class="nav-section">
                    <div class="nav-section-header" onclick="toggleSection(this)">
                        <div class="nav-section-title"><span class="nav-section-icon">ğŸ—ï¸</span>Network Architecture</div>
                        <span class="nav-section-toggle">â–¼</span>
                    </div>
                    <div class="nav-section-content">
                        <a href="7-1-network-segmentation.html" class="nav-link"><span class="nav-link-number">7.1</span> Network Segmentation</a>
                        <a href="7-2-zero-trust.html" class="nav-link"><span class="nav-link-number">7.2</span> Zero Trust Network</a>
                        <a href="7-3-zscaler-platform.html" class="nav-link"><span class="nav-link-number">7.3</span> Zscaler Platform</a>
                        <a href="7-4-threat-intel.html" class="nav-link"><span class="nav-link-number">7.4</span> Network Threat Intelligence</a>
                        <a href="7-5-active-directory.html" class="nav-link"><span class="nav-link-number">7.5</span> Active Directory Security</a>
                        <a href="7-7-nac.html" class="nav-link"><span class="nav-link-number">7.7</span> Network Access Control</a>
                        <a href="7-8-datacenter-security.html" class="nav-link"><span class="nav-link-number">7.8</span> Data Center Security</a>
                        <a href="7-9-network-automation.html" class="nav-link"><span class="nav-link-number">7.9</span> Network Automation Security</a>
                    </div>
                </div>

                <!-- Section 8: Load Balancers -->
                <div class="nav-section">
                    <div class="nav-section-header" onclick="toggleSection(this)">
                        <div class="nav-section-title"><span class="nav-section-icon">âš–ï¸</span>Load Balancers</div>
                        <span class="nav-section-toggle">â–¼</span>
                    </div>
                    <div class="nav-section-content">
                        <a href="8-1-lb-fundamentals.html" class="nav-link"><span class="nav-link-number">8.1</span> Load Balancer Fundamentals</a>
                        <a href="8-2-f5-bigip.html" class="nav-link"><span class="nav-link-number">8.2</span> F5 BIG-IP</a>
                        <a href="8-3-aws-elb.html" class="nav-link"><span class="nav-link-number">8.3</span> AWS ALB/NLB</a>
                        <a href="8-4-haproxy.html" class="nav-link"><span class="nav-link-number">8.4</span> HAProxy</a>
                        <a href="8-5-nginx.html" class="nav-link"><span class="nav-link-number">8.5</span> NGINX</a>
                    </div>
                </div>

                <!-- Section 10: SIEM -->
                <div class="nav-section">
                    <div class="nav-section-header" onclick="toggleSection(this)">
                        <div class="nav-section-title"><span class="nav-section-icon">ğŸ“Š</span>SIEM & Log Analysis</div>
                        <span class="nav-section-toggle">â–¼</span>
                    </div>
                    <div class="nav-section-content">
                        <a href="10-1-siem-fundamentals.html" class="nav-link"><span class="nav-link-number">10.1</span> SIEM Fundamentals</a>
                        <a href="10-2-splunk.html" class="nav-link"><span class="nav-link-number">10.2</span> Splunk</a>
                        <a href="10-3-microsoft-sentinel.html" class="nav-link"><span class="nav-link-number">10.3</span> Microsoft Sentinel</a>
                        <a href="10-4-elastic-security.html" class="nav-link"><span class="nav-link-number">10.4</span> Elastic Security</a>
                    </div>
                </div>

                <!-- Section 12: Network Operations -->
                <div class="nav-section">
                    <div class="nav-section-header" onclick="toggleSection(this)">
                        <div class="nav-section-title"><span class="nav-section-icon">ğŸ”§</span>Network Operations</div>
                        <span class="nav-section-toggle">â–¼</span>
                    </div>
                    <div class="nav-section-content">
                        <a href="12-1-methodology.html" class="nav-link"><span class="nav-link-number">12.1</span> Troubleshooting Methodology</a>
                        <a href="12-2-incident-response.html" class="nav-link"><span class="nav-link-number">12.2</span> Network Incident Response</a>
                        <a href="12-3-log-analysis.html" class="nav-link"><span class="nav-link-number">12.3</span> Network Log Analysis</a>
                        <a href="12-4-packet-capture.html" class="nav-link"><span class="nav-link-number">12.4</span> Packet Capture & Analysis</a>
                        <a href="12-5-threat-hunting.html" class="nav-link"><span class="nav-link-number">12.5</span> Network Threat Hunting</a>
                        <a href="12-6-netflow.html" class="nav-link"><span class="nav-link-number">12.6</span> NetFlow & sFlow</a>
                        <a href="12-7-network-forensics.html" class="nav-link"><span class="nav-link-number">12.7</span> Network Forensics</a>
                        <a href="12-8-network-pentesting.html" class="nav-link"><span class="nav-link-number">12.8</span> Network Pentesting</a>
                    </div>
                </div>

                <!-- Section 13: Compliance -->
                <div class="nav-section">
                    <div class="nav-section-header" onclick="toggleSection(this)">
                        <div class="nav-section-title"><span class="nav-section-icon">ğŸ“‹</span>Compliance</div>
                        <span class="nav-section-toggle">â–¼</span>
                    </div>
                    <div class="nav-section-content">
                        <a href="13-1-compliance-frameworks.html" class="nav-link"><span class="nav-link-number">13.1</span> Network Compliance</a>
                        <a href="13-2-vulnerability-management.html" class="nav-link"><span class="nav-link-number">13.2</span> Vulnerability Scanning</a>
                    </div>
                </div>

                <!-- Section 14: Cloud Network Security -->
                <div class="nav-section">
                    <div class="nav-section-header" onclick="toggleSection(this)">
                        <div class="nav-section-title"><span class="nav-section-icon">â˜ï¸</span>Cloud Network Security</div>
                        <span class="nav-section-toggle">â–¼</span>
                    </div>
                    <div class="nav-section-content">
                        <a href="14-1-cloud-security.html" class="nav-link"><span class="nav-link-number">14.1</span> Cloud Network Fundamentals</a>
                        <a href="14-2-aws-security.html" class="nav-link"><span class="nav-link-number">14.2</span> AWS Network Security</a>
                        <a href="14-3-azure-security.html" class="nav-link"><span class="nav-link-number">14.3</span> Azure Network Security</a>
                        <a href="14-4-gcp-security.html" class="nav-link"><span class="nav-link-number">14.4</span> GCP Network Security</a>
                        <a href="14-5-container-security.html" class="nav-link"><span class="nav-link-number">14.5</span> Container Network Security</a>
                        <a href="14-6-casb.html" class="nav-link"><span class="nav-link-number">14.6</span> CASB</a>
                        <a href="14-7-aws-vpc-deep-dive.html" class="nav-link"><span class="nav-link-number">14.7</span> AWS VPC Deep Dive</a>
                        <a href="14-8-azure-networking.html" class="nav-link"><span class="nav-link-number">14.8</span> Azure Networking Deep Dive</a>
                        <a href="14-9-service-mesh.html" class="nav-link"><span class="nav-link-number">14.9</span> Service Mesh Security</a>
                        <a href="14-10-kubernetes-networking.html" class="nav-link"><span class="nav-link-number">14.10</span> Kubernetes Networking</a>
                    </div>
                </div>

                <!-- Section 23: IoT/OT -->
                <div class="nav-section">
                    <div class="nav-section-header" onclick="toggleSection(this)">
                        <div class="nav-section-title"><span class="nav-section-icon">ğŸ“¡</span>IoT/OT Security</div>
                        <span class="nav-section-toggle">â–¼</span>
                    </div>
                    <div class="nav-section-content">
                        <a href="23-1-iot-security.html" class="nav-link"><span class="nav-link-number">23.1</span> IoT Network Security</a>
                    </div>
                </div>

                <!-- Section 15: Resources -->
                <div class="nav-section">
                    <div class="nav-section-header" onclick="toggleSection(this)">
                        <div class="nav-section-title"><span class="nav-section-icon">ğŸ“š</span>Resources</div>
                        <span class="nav-section-toggle">â–¼</span>
                    </div>
                    <div class="nav-section-content">
                        <a href="15-2-interview-questions.html" class="nav-link"><span class="nav-link-number">15.2</span> Interview Questions</a>
                        <a href="15-4-cheat-sheets.html" class="nav-link"><span class="nav-link-number">15.4</span> Command Cheat Sheets</a>
                    </div>
                </div>
            </nav>
        </aside>
        
        <!-- Main Content -->
        <main class="main-content">
            <!-- Header -->
            <header class="content-header">
                <div class="header-left">
                    <button class="sidebar-toggle" id="sidebarToggle">â˜°</button>
                    <div class="breadcrumb">
                        <span class="breadcrumb-item"><a href="index.html">Home</a></span>
                        <span class="breadcrumb-separator">/</span>
                        <span class="breadcrumb-item">VPN Technologies</span>
                        <span class="breadcrumb-separator">/</span>
                        <span class="breadcrumb-current">IPSec Deep Dive</span>
                    </div>
                </div>
                <div class="header-right">
                    <button class="header-btn" onclick="printPage()">ğŸ–¨ï¸ Print</button>
                </div>
            </header>
            
            <!-- Content Body -->
            <div class="content-body">
                <h1>IPSec Deep Dive</h1>
                
                <!-- Overview Box -->
                <div class="overview-box">
                    <div class="overview-title">ğŸ“‹ What You'll Learn</div>
                    <div class="overview-content">
                        <p>IPSec (Internet Protocol Security) is the industry standard for securing IP communications through authentication and encryption. Understanding IPSec internals is essential for configuring, troubleshooting, and securing VPN connections.</p>
                        <ul>
                            <li>IPSec architecture and components</li>
                            <li>IKE Phase 1 (Main Mode vs Aggressive Mode)</li>
                            <li>IKE Phase 2 (Quick Mode)</li>
                            <li>ESP vs AH protocols</li>
                            <li>Tunnel mode vs Transport mode</li>
                            <li>Encryption and hashing algorithms</li>
                            <li>Diffie-Hellman key exchange</li>
                            <li>Perfect Forward Secrecy (PFS)</li>
                        </ul>
                    </div>
                </div>
                
                <h2>IPSec Architecture Overview</h2>
                
                <p>IPSec is a suite of protocols that provides security at the network layer (Layer 3). It can protect any IP traffic, regardless of the application, making it ideal for site-to-site VPNs and remote access solutions.</p>
                
                <div class="ascii-diagram">
                    <div class="ascii-diagram-title">IPSec Protocol Suite Components</div>
<pre>
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         IPSEC PROTOCOL SUITE                                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚                    IKE (Internet Key Exchange)                       â”‚    â”‚
â”‚  â”‚                    Establishes Security Associations                 â”‚    â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤    â”‚
â”‚  â”‚  IKEv1                           â”‚  IKEv2                            â”‚    â”‚
â”‚  â”‚  â€¢ Phase 1: ISAKMP SA            â”‚  â€¢ IKE_SA_INIT                    â”‚    â”‚
â”‚  â”‚  â€¢ Phase 2: IPSec SA             â”‚  â€¢ IKE_AUTH                       â”‚    â”‚
â”‚  â”‚  â€¢ 6-9 messages (Main Mode)      â”‚  â€¢ 4 messages (simplified)        â”‚    â”‚
â”‚  â”‚  â€¢ Legacy, widely deployed       â”‚  â€¢ Modern, recommended            â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                    â”‚                                         â”‚
â”‚                                    â–¼                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚              DATA PROTECTION PROTOCOLS                                â”‚   â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”‚
â”‚  â”‚           ESP               â”‚              AH                         â”‚   â”‚
â”‚  â”‚  (Encapsulating Security    â”‚   (Authentication Header)              â”‚   â”‚
â”‚  â”‚       Payload)              â”‚                                         â”‚   â”‚
â”‚  â”‚                             â”‚                                         â”‚   â”‚
â”‚  â”‚  âœ“ Encryption               â”‚   âœ— No Encryption                      â”‚   â”‚
â”‚  â”‚  âœ“ Authentication           â”‚   âœ“ Authentication                     â”‚   â”‚
â”‚  â”‚  âœ“ Integrity                â”‚   âœ“ Integrity                          â”‚   â”‚
â”‚  â”‚  âœ“ Anti-replay              â”‚   âœ“ Anti-replay                        â”‚   â”‚
â”‚  â”‚                             â”‚                                         â”‚   â”‚
â”‚  â”‚  Protocol: 50               â”‚   Protocol: 51                         â”‚   â”‚
â”‚  â”‚  RECOMMENDED                â”‚   RARELY USED                          â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚                    MODES OF OPERATION                                â”‚    â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤    â”‚
â”‚  â”‚        TUNNEL MODE             â”‚       TRANSPORT MODE               â”‚    â”‚
â”‚  â”‚                                â”‚                                     â”‚    â”‚
â”‚  â”‚  â€¢ Entire IP packet encrypted  â”‚  â€¢ Only payload encrypted          â”‚    â”‚
â”‚  â”‚  â€¢ New IP header added         â”‚  â€¢ Original IP header preserved    â”‚    â”‚
â”‚  â”‚  â€¢ Used for: Site-to-Site VPN  â”‚  â€¢ Used for: Host-to-Host          â”‚    â”‚
â”‚  â”‚  â€¢ Gateway to Gateway          â”‚  â€¢ End-to-End encryption           â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</pre>
                </div>
                
                <h2>IKE Phase 1 - Establishing the Management Tunnel</h2>
                
                <p>IKE Phase 1 establishes a secure, authenticated channel (ISAKMP SA) between two peers. This channel is used to negotiate the IPSec (Phase 2) parameters securely.</p>
                
                <div class="ascii-diagram">
                    <div class="ascii-diagram-title">IKE Phase 1 - Main Mode (6 Messages)</div>
<pre>
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    IKE PHASE 1 - MAIN MODE                                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚     INITIATOR                                              RESPONDER        â”‚
â”‚    (Site A FW)                                            (Site B FW)       â”‚
â”‚         â”‚                                                      â”‚            â”‚
â”‚         â”‚  â•â•â•â•â•â•â•â•â•â•â•â•â•â• Message 1 â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â–º     â”‚            â”‚
â”‚         â”‚     SA Proposal (encryption, hash, DH group,         â”‚            â”‚
â”‚         â”‚     authentication method, lifetime)                 â”‚            â”‚
â”‚         â”‚                                                      â”‚            â”‚
â”‚         â”‚  â—„â•â•â•â•â•â•â•â•â•â•â•â•â• Message 2 â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•     â”‚            â”‚
â”‚         â”‚     SA Selection (chosen parameters)                 â”‚            â”‚
â”‚         â”‚                                                      â”‚            â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”      â”‚
â”‚   â”‚           NEGOTIATION COMPLETE - Parameters Agreed              â”‚      â”‚
â”‚   â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜      â”‚
â”‚         â”‚                                                      â”‚            â”‚
â”‚         â”‚  â•â•â•â•â•â•â•â•â•â•â•â•â•â• Message 3 â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â–º     â”‚            â”‚
â”‚         â”‚     Key Exchange (DH public value, nonce)            â”‚            â”‚
â”‚         â”‚                                                      â”‚            â”‚
â”‚         â”‚  â—„â•â•â•â•â•â•â•â•â•â•â•â•â• Message 4 â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•     â”‚            â”‚
â”‚         â”‚     Key Exchange (DH public value, nonce)            â”‚            â”‚
â”‚         â”‚                                                      â”‚            â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”      â”‚
â”‚   â”‚        KEY MATERIAL GENERATED - Shared Secret Established       â”‚      â”‚
â”‚   â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜      â”‚
â”‚         â”‚                                                      â”‚            â”‚
â”‚         â”‚  â•â•â•â•â•â•â•â•â•â•â•â•â•â• Message 5 â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â–º     â”‚   â—„â”€â”€â”€â”   â”‚
â”‚         â”‚     Identity + Authentication (ENCRYPTED)            â”‚       â”‚   â”‚
â”‚         â”‚                                                      â”‚       â”‚   â”‚
â”‚         â”‚  â—„â•â•â•â•â•â•â•â•â•â•â•â•â• Message 6 â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•     â”‚  ENCRYPTEDâ”‚
â”‚         â”‚     Identity + Authentication (ENCRYPTED)            â”‚       â”‚   â”‚
â”‚         â”‚                                                      â”‚   â—„â”€â”€â”€â”˜   â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”      â”‚
â”‚   â”‚              ISAKMP SA ESTABLISHED (Phase 1 Complete)           â”‚      â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â”‚                                                                              â”‚
â”‚  PHASE 1 PARAMETERS TO CONFIGURE:                                           â”‚
â”‚  â€¢ Encryption: AES-256, AES-128, 3DES (deprecated)                         â”‚
â”‚  â€¢ Hash: SHA-256, SHA-384, SHA-512, MD5/SHA-1 (deprecated)                 â”‚
â”‚  â€¢ DH Group: 14 (2048-bit), 19/20 (ECC), 21 (ECC 521-bit)                 â”‚
â”‚  â€¢ Authentication: Pre-shared Key (PSK) or Certificates (PKI)              â”‚
â”‚  â€¢ Lifetime: 28800 seconds (8 hours) typical                               â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</pre>
                </div>
                
                <h3>Main Mode vs Aggressive Mode</h3>
                
                <div class="table-wrapper">
                    <table>
                        <thead>
                            <tr>
                                <th>Aspect</th>
                                <th>Main Mode</th>
                                <th>Aggressive Mode</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td><strong>Messages</strong></td>
                                <td>6 messages</td>
                                <td>3 messages</td>
                            </tr>
                            <tr>
                                <td><strong>Identity Protection</strong></td>
                                <td>Yes - identity encrypted in messages 5-6</td>
                                <td>No - identity sent in clear text</td>
                            </tr>
                            <tr>
                                <td><strong>Speed</strong></td>
                                <td>Slower (more round trips)</td>
                                <td>Faster</td>
                            </tr>
                            <tr>
                                <td><strong>Security</strong></td>
                                <td>More secure</td>
                                <td>Less secure (vulnerable to attacks)</td>
                            </tr>
                            <tr>
                                <td><strong>Use Case</strong></td>
                                <td>Standard site-to-site VPNs</td>
                                <td>Legacy, dynamic IP scenarios (avoid if possible)</td>
                            </tr>
                            <tr>
                                <td><strong>Recommendation</strong></td>
                                <td>âœ… Preferred</td>
                                <td>âš ï¸ Avoid (use IKEv2 instead)</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
                
                <div class="callout callout-warning">
                    <div class="callout-title">âš ï¸ Security Warning</div>
                    <div class="callout-content">
                        <p><strong>Avoid Aggressive Mode with Pre-Shared Keys!</strong></p>
                        <p>In Aggressive Mode, the identity (often the PSK hash) is sent unencrypted. Attackers can capture this and perform offline dictionary attacks against weak pre-shared keys. If you must use PSK, use Main Mode or (better) migrate to IKEv2.</p>
                    </div>
                </div>
                
                <h2>IKE Phase 2 - Establishing the Data Tunnel</h2>
                
                <p>Phase 2 (Quick Mode) negotiates the IPSec Security Associations that will protect the actual user traffic. Multiple Phase 2 tunnels can exist within a single Phase 1 SA.</p>
                
                <div class="ascii-diagram">
                    <div class="ascii-diagram-title">IKE Phase 2 - Quick Mode (3 Messages)</div>
<pre>
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    IKE PHASE 2 - QUICK MODE                                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚     All messages encrypted with Phase 1 keys                                â”‚
â”‚                                                                              â”‚
â”‚     INITIATOR                                              RESPONDER        â”‚
â”‚         â”‚                                                      â”‚            â”‚
â”‚         â”‚  â•â•â•â•â•â•â•â•â•â•â•â•â•â• Message 1 â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â–º     â”‚            â”‚
â”‚         â”‚     â€¢ SA Proposal (ESP/AH, encryption, hash)         â”‚            â”‚
â”‚         â”‚     â€¢ Proxy IDs (source/destination networks)        â”‚            â”‚
â”‚         â”‚     â€¢ Nonce                                          â”‚            â”‚
â”‚         â”‚     â€¢ [Optional: DH for PFS]                         â”‚            â”‚
â”‚         â”‚                                                      â”‚            â”‚
â”‚         â”‚  â—„â•â•â•â•â•â•â•â•â•â•â•â•â• Message 2 â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•     â”‚            â”‚
â”‚         â”‚     â€¢ SA Selection                                   â”‚            â”‚
â”‚         â”‚     â€¢ Proxy IDs                                      â”‚            â”‚
â”‚         â”‚     â€¢ Nonce                                          â”‚            â”‚
â”‚         â”‚     â€¢ [Optional: DH for PFS]                         â”‚            â”‚
â”‚         â”‚                                                      â”‚            â”‚
â”‚         â”‚  â•â•â•â•â•â•â•â•â•â•â•â•â•â• Message 3 â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â–º     â”‚            â”‚
â”‚         â”‚     â€¢ Hash (confirmation)                            â”‚            â”‚
â”‚         â”‚                                                      â”‚            â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”      â”‚
â”‚   â”‚              IPSEC SA ESTABLISHED (Phase 2 Complete)            â”‚      â”‚
â”‚   â”‚         Traffic can now flow through encrypted tunnel           â”‚      â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â”‚                                                                              â”‚
â”‚  PHASE 2 PARAMETERS:                                                        â”‚
â”‚  â€¢ Protocol: ESP (recommended) or AH                                        â”‚
â”‚  â€¢ Encryption: AES-256-GCM, AES-256-CBC, AES-128-GCM                       â”‚
â”‚  â€¢ Hash/Integrity: SHA-256, SHA-384, SHA-512                               â”‚
â”‚  â€¢ PFS: Enable with DH group 14, 19, or 20                                 â”‚
â”‚  â€¢ Lifetime: 3600 seconds (1 hour) or by traffic volume                    â”‚
â”‚  â€¢ Proxy IDs: Networks/hosts that trigger the tunnel                       â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</pre>
                </div>
                
                <div class="callout callout-interview">
                    <div class="callout-title">ğŸ’¡ Interview Tip</div>
                    <div class="callout-content">
                        <p><strong>Common Question:</strong> "What is the difference between IKE Phase 1 and Phase 2?"</p>
                        <p><strong>Answer:</strong></p>
                        <ul>
                            <li><strong>Phase 1</strong> establishes a secure, authenticated management channel (ISAKMP SA) between two VPN peers. It's used to protect the Phase 2 negotiation. Think of it as the "secure phone line" for negotiation.</li>
                            <li><strong>Phase 2</strong> establishes the actual IPSec SAs that encrypt user traffic. Multiple Phase 2 tunnels (for different networks) can use the same Phase 1 SA. This is the "actual encrypted tunnel" for data.</li>
                        </ul>
                        <p><strong>Analogy:</strong> Phase 1 is like establishing a secure channel to exchange secret codes. Phase 2 is using those codes to encrypt the actual messages.</p>
                    </div>
                </div>
                
                <h2>ESP vs AH</h2>
                
                <div class="ascii-diagram">
                    <div class="ascii-diagram-title">ESP Packet Structure (Tunnel Mode)</div>
<pre>
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    ESP PACKET - TUNNEL MODE                                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚  ORIGINAL IP PACKET:                                                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ Original IP    â”‚           Original Payload (TCP/UDP + Data)         â”‚   â”‚
â”‚  â”‚    Header      â”‚                                                      â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                     â”‚                                        â”‚
â”‚                                     â–¼                                        â”‚
â”‚  ESP ENCAPSULATED (TUNNEL MODE):                                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  NEW IP    â”‚    ESP     â”‚      ENCRYPTED PAYLOAD             â”‚  ESP   â”‚ â”‚
â”‚  â”‚  Header    â”‚   Header   â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”¤  Auth  â”‚ â”‚
â”‚  â”‚            â”‚            â”‚  â”‚ Original   â”‚ Original       â”‚Padâ”‚        â”‚ â”‚
â”‚  â”‚ Src: GW-A  â”‚ SPI        â”‚  â”‚ IP Header  â”‚ Payload        â”‚   â”‚ ICV    â”‚ â”‚
â”‚  â”‚ Dst: GW-B  â”‚ Seq Num    â”‚  â”‚            â”‚                â”‚   â”‚        â”‚ â”‚
â”‚  â”‚ Proto: 50  â”‚            â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”˜        â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                             â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º         â”‚
â”‚                                        ENCRYPTED                            â”‚
â”‚                             â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚
â”‚                                      AUTHENTICATED (ICV)                    â”‚
â”‚                                                                              â”‚
â”‚  COMPONENTS:                                                                â”‚
â”‚  â€¢ New IP Header: Uses VPN gateway IPs (hides internal addressing)         â”‚
â”‚  â€¢ ESP Header: Contains SPI (identifies SA) and Sequence Number            â”‚
â”‚  â€¢ Encrypted Payload: Original packet + padding                            â”‚
â”‚  â€¢ ESP Auth (ICV): Integrity Check Value - ensures no tampering            â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</pre>
                </div>
                
                <h2>Encryption and Hashing Algorithms</h2>
                
                <h3>Recommended Algorithms (2024+)</h3>
                
                <div class="table-wrapper">
                    <table>
                        <thead>
                            <tr>
                                <th>Function</th>
                                <th>Recommended</th>
                                <th>Acceptable</th>
                                <th>Deprecated/Avoid</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td><strong>Encryption</strong></td>
                                <td>AES-256-GCM, AES-256-CBC</td>
                                <td>AES-128-GCM, AES-128-CBC</td>
                                <td>3DES, DES, RC4</td>
                            </tr>
                            <tr>
                                <td><strong>Integrity/Hash</strong></td>
                                <td>SHA-384, SHA-512</td>
                                <td>SHA-256</td>
                                <td>SHA-1, MD5</td>
                            </tr>
                            <tr>
                                <td><strong>DH Group (Phase 1)</strong></td>
                                <td>Group 20 (ECDH 384-bit), Group 21</td>
                                <td>Group 14 (2048-bit), Group 19</td>
                                <td>Groups 1, 2, 5 (1024-bit or less)</td>
                            </tr>
                            <tr>
                                <td><strong>PFS Group (Phase 2)</strong></td>
                                <td>Same as Phase 1 DH</td>
                                <td>Group 14, 19, 20</td>
                                <td>None, Groups 1, 2, 5</td>
                            </tr>
                            <tr>
                                <td><strong>PRF (IKEv2)</strong></td>
                                <td>SHA-384, SHA-512</td>
                                <td>SHA-256</td>
                                <td>SHA-1, MD5</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
                
                <div class="callout callout-bestpractice">
                    <div class="callout-title">âœ… Best Practice - Modern IPSec Configuration</div>
                    <div class="callout-content">
                        <p><strong>Recommended IKEv2 Configuration:</strong></p>
                        <ul>
                            <li><strong>Phase 1:</strong> AES-256-GCM, SHA-384, DH Group 20 (ECDH), Lifetime 8 hours</li>
                            <li><strong>Phase 2:</strong> AES-256-GCM, SHA-384, PFS Group 20, Lifetime 1 hour</li>
                            <li><strong>Authentication:</strong> Certificates (PKI) preferred over PSK</li>
                            <li><strong>Dead Peer Detection:</strong> Enable with 30-second intervals</li>
                        </ul>
                    </div>
                </div>
                
                <h2>Diffie-Hellman Key Exchange</h2>
                
                <p>Diffie-Hellman allows two parties to establish a shared secret over an insecure channel without ever transmitting the secret itself. This is the mathematical magic that makes IPSec possible.</p>
                
                <div class="ascii-diagram">
                    <div class="ascii-diagram-title">Diffie-Hellman Key Exchange (Simplified)</div>
<pre>
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    DIFFIE-HELLMAN KEY EXCHANGE                               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚     ALICE (Site A)                                    BOB (Site B)          â”‚
â”‚                                                                              â”‚
â”‚     Private Key: a = 6                               Private Key: b = 15    â”‚
â”‚     (secret, never shared)                           (secret, never shared) â”‚
â”‚                                                                              â”‚
â”‚                      Agreed Public Values:                                   â”‚
â”‚                      â€¢ Prime (p) = 23                                        â”‚
â”‚                      â€¢ Generator (g) = 5                                     â”‚
â”‚                                                                              â”‚
â”‚     Calculate Public Value:                          Calculate Public Value:â”‚
â”‚     A = g^a mod p                                    B = g^b mod p          â”‚
â”‚     A = 5^6 mod 23 = 8                               B = 5^15 mod 23 = 19   â”‚
â”‚         â”‚                                                      â”‚            â”‚
â”‚         â”‚  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â–º   â”‚            â”‚
â”‚         â”‚            Exchange Public Values                    â”‚            â”‚
â”‚         â”‚  â—„â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•   â”‚            â”‚
â”‚         â”‚                                                      â”‚            â”‚
â”‚     Calculate Shared Secret:                         Calculate Shared Secretâ”‚
â”‚     s = B^a mod p                                    s = A^b mod p          â”‚
â”‚     s = 19^6 mod 23 = 2                              s = 8^15 mod 23 = 2    â”‚
â”‚                                                                              â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚   â”‚           SHARED SECRET = 2 (Both sides computed same value!)       â”‚   â”‚
â”‚   â”‚                                                                      â”‚   â”‚
â”‚   â”‚  Even if attacker intercepts: p=23, g=5, A=8, B=19                  â”‚   â”‚
â”‚   â”‚  They cannot compute the shared secret without a or b               â”‚   â”‚
â”‚   â”‚  (This is the Discrete Logarithm Problem - computationally hard)    â”‚   â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                              â”‚
â”‚  REAL-WORLD DH GROUPS:                                                      â”‚
â”‚  â€¢ Group 14: 2048-bit MODP (minimum recommended)                           â”‚
â”‚  â€¢ Group 19: 256-bit ECC (ECDH)                                            â”‚
â”‚  â€¢ Group 20: 384-bit ECC (ECDH) - recommended                              â”‚
â”‚  â€¢ Group 21: 521-bit ECC (ECDH) - highest security                         â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</pre>
                </div>
                
                <h2>Perfect Forward Secrecy (PFS)</h2>
                
                <p>PFS ensures that if a long-term key is compromised, previously captured encrypted traffic cannot be decrypted. Each session uses fresh DH key exchange.</p>
                
                <div class="callout callout-critical">
                    <div class="callout-title">ğŸ”´ Critical Security Feature</div>
                    <div class="callout-content">
                        <p><strong>Always enable PFS for IPSec Phase 2!</strong></p>
                        <p><strong>Without PFS:</strong> If an attacker captures encrypted VPN traffic and later obtains the Phase 1 keys, they can derive all Phase 2 keys and decrypt historical traffic.</p>
                        <p><strong>With PFS:</strong> Each Phase 2 rekey performs a new DH exchange. Compromising Phase 1 keys doesn't help decrypt past sessions.</p>
                        <p><strong>Recommendation:</strong> Use PFS with DH Group 14 or higher. The small performance impact is worth the significant security benefit.</p>
                    </div>
                </div>
                
                <h2>Configuration Examples</h2>
                
                <div class="code-block">
                    <div class="code-header">
                        <span class="code-lang">Palo Alto Networks - IKEv2 VPN Configuration</span>
                        <button class="code-copy-btn">ğŸ“‹ Copy</button>
                    </div>
                    <pre><code><span class="token-comment"># IKE Crypto Profile (Phase 1)</span>
<span class="token-keyword">set</span> network ike crypto-profiles ike-crypto-profiles IKEv2-Secure
<span class="token-keyword">set</span> network ike crypto-profiles ike-crypto-profiles IKEv2-Secure hash sha384
<span class="token-keyword">set</span> network ike crypto-profiles ike-crypto-profiles IKEv2-Secure dh-group group20
<span class="token-keyword">set</span> network ike crypto-profiles ike-crypto-profiles IKEv2-Secure encryption aes-256-gcm
<span class="token-keyword">set</span> network ike crypto-profiles ike-crypto-profiles IKEv2-Secure lifetime hours 8

<span class="token-comment"># IPSec Crypto Profile (Phase 2)</span>
<span class="token-keyword">set</span> network ike crypto-profiles ipsec-crypto-profiles IPSec-Secure
<span class="token-keyword">set</span> network ike crypto-profiles ipsec-crypto-profiles IPSec-Secure esp encryption aes-256-gcm
<span class="token-keyword">set</span> network ike crypto-profiles ipsec-crypto-profiles IPSec-Secure esp authentication sha384
<span class="token-keyword">set</span> network ike crypto-profiles ipsec-crypto-profiles IPSec-Secure dh-group group20
<span class="token-keyword">set</span> network ike crypto-profiles ipsec-crypto-profiles IPSec-Secure lifetime hours 1

<span class="token-comment"># IKE Gateway</span>
<span class="token-keyword">set</span> network ike gateway IKE-Gateway-SiteB
<span class="token-keyword">set</span> network ike gateway IKE-Gateway-SiteB protocol ikev2-only
<span class="token-keyword">set</span> network ike gateway IKE-Gateway-SiteB peer-address ip 203.0.113.10
<span class="token-keyword">set</span> network ike gateway IKE-Gateway-SiteB authentication pre-shared-key key "ComplexP@ssw0rd!"
<span class="token-keyword">set</span> network ike gateway IKE-Gateway-SiteB protocol-common fragmentation enable yes
<span class="token-keyword">set</span> network ike gateway IKE-Gateway-SiteB protocol ikev2 dpd enable yes
<span class="token-keyword">set</span> network ike gateway IKE-Gateway-SiteB protocol ikev2 dpd interval 30

<span class="token-comment"># IPSec Tunnel</span>
<span class="token-keyword">set</span> network tunnel ipsec IPSec-Tunnel-SiteB
<span class="token-keyword">set</span> network tunnel ipsec IPSec-Tunnel-SiteB auto-key ike-gateway IKE-Gateway-SiteB
<span class="token-keyword">set</span> network tunnel ipsec IPSec-Tunnel-SiteB auto-key ipsec-crypto-profile IPSec-Secure
<span class="token-keyword">set</span> network tunnel ipsec IPSec-Tunnel-SiteB tunnel-interface tunnel.1

<span class="token-comment"># Verify tunnel status</span>
<span class="token-command">show</span> vpn ike-sa
<span class="token-command">show</span> vpn ipsec-sa
<span class="token-command">show</span> vpn flow</code></pre>
                </div>
                
                <div class="code-block">
                    <div class="code-header">
                        <span class="code-lang">Cisco ASA - IKEv2 Site-to-Site VPN</span>
                        <button class="code-copy-btn">ğŸ“‹ Copy</button>
                    </div>
                    <pre><code><span class="token-comment">! IKEv2 Policy (Phase 1)</span>
<span class="token-keyword">crypto ikev2 policy</span> 10
 <span class="token-keyword">encryption</span> aes-gcm-256
 <span class="token-keyword">integrity</span> sha384
 <span class="token-keyword">group</span> 20
 <span class="token-keyword">prf</span> sha384
 <span class="token-keyword">lifetime seconds</span> 28800

<span class="token-comment">! IPSec Transform Set (Phase 2)</span>
<span class="token-keyword">crypto ipsec ikev2 ipsec-proposal</span> AES256-GCM
 <span class="token-keyword">protocol esp encryption</span> aes-gcm-256
 <span class="token-keyword">protocol esp integrity</span> sha-384

<span class="token-comment">! Tunnel Group (VPN Peer)</span>
<span class="token-keyword">tunnel-group</span> 203.0.113.10 type ipsec-l2l
<span class="token-keyword">tunnel-group</span> 203.0.113.10 ipsec-attributes
 <span class="token-keyword">ikev2 remote-authentication</span> pre-shared-key ComplexP@ssw0rd!
 <span class="token-keyword">ikev2 local-authentication</span> pre-shared-key ComplexP@ssw0rd!

<span class="token-comment">! Crypto Map</span>
<span class="token-keyword">crypto map</span> CRYPTO-MAP 10 match address VPN-TRAFFIC
<span class="token-keyword">crypto map</span> CRYPTO-MAP 10 set peer 203.0.113.10
<span class="token-keyword">crypto map</span> CRYPTO-MAP 10 set ikev2 ipsec-proposal AES256-GCM
<span class="token-keyword">crypto map</span> CRYPTO-MAP 10 set pfs group20

<span class="token-comment">! Apply to interface</span>
<span class="token-keyword">crypto map</span> CRYPTO-MAP interface outside

<span class="token-comment">! Verify</span>
<span class="token-command">show</span> crypto ikev2 sa
<span class="token-command">show</span> crypto ipsec sa</code></pre>
                </div>
                
                <!-- Day-to-Day Tasks -->
                <div class="callout callout-daily">
                    <div class="callout-title">ğŸ“… Day-to-Day Tasks</div>
                    <div class="callout-content">
                        <p><strong>IPSec VPN management tasks you'll perform regularly:</strong></p>
                        <ul>
                            <li><strong>Monitoring:</strong> Check tunnel status, rekey events, DPD failures</li>
                            <li><strong>Troubleshooting:</strong> Debug Phase 1/Phase 2 failures, proxy ID mismatches</li>
                            <li><strong>Configuration:</strong> Add new site-to-site tunnels, update encryption policies</li>
                            <li><strong>Key Rotation:</strong> Update pre-shared keys on schedule (quarterly recommended)</li>
                            <li><strong>Certificate Management:</strong> Renew certificates before expiration</li>
                            <li><strong>Capacity Planning:</strong> Monitor tunnel counts, throughput, CPU on VPN devices</li>
                            <li><strong>Documentation:</strong> Maintain tunnel inventory with peer IPs, networks, contacts</li>
                        </ul>
                    </div>
                </div>
                
                <div class="callout callout-interview">
                    <div class="callout-title">ğŸ’¡ Interview Tip</div>
                    <div class="callout-content">
                        <p><strong>Common Question:</strong> "How would you troubleshoot a VPN tunnel that won't come up?"</p>
                        <p><strong>Systematic Answer:</strong></p>
                        <ol>
                            <li><strong>Check Phase 1:</strong> Do the proposals match? (encryption, hash, DH group, lifetime)</li>
                            <li><strong>Verify connectivity:</strong> Can peers reach each other on UDP 500/4500?</li>
                            <li><strong>Authentication:</strong> Is the PSK/certificate correct on both sides?</li>
                            <li><strong>Check Phase 2:</strong> Do proxy IDs/interesting traffic definitions match exactly?</li>
                            <li><strong>Review logs:</strong> Enable IKE debugging to see specific error messages</li>
                            <li><strong>Common issues:</strong> NAT-T problems, asymmetric routing, firewall blocking</li>
                        </ol>
                    </div>
                </div>
                
                <!-- Page Navigation -->
                <nav class="page-navigation">
                    <a href="6-1-vpn-fundamentals.html" class="page-nav-btn prev">
                        <span class="page-nav-arrow">â†</span>
                        <div class="page-nav-text">
                            <span class="page-nav-label">Previous</span>
                            <span class="page-nav-title">VPN Fundamentals</span>
                        </div>
                    </a>
                    <a href="6-3-site-to-site.html" class="page-nav-btn next">
                        <span class="page-nav-arrow">â†’</span>
                        <div class="page-nav-text">
                            <span class="page-nav-label">Next</span>
                            <span class="page-nav-title">Site-to-Site VPN</span>
                        </div>
                    </a>
                </nav>
            </div>
        </main>
    </div>
    
    <!-- Search Modal -->
    <div class="search-modal" id="searchModal">
        <div class="search-modal-content">
            <input type="text" class="search-modal-input" id="searchModalInput" placeholder="Search documentation...">
            <div class="search-results" id="searchResults"></div>
        </div>
    </div>
    
    <script src="main.js"></script>
</body>
</html>
