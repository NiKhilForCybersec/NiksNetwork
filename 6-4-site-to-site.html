<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Site-to-Site VPN - Complete guide to connecting networks, IPSec tunnels, and hybrid cloud connectivity">
    <title>Site-to-Site VPN | Network Security Guide</title>
    <link rel="stylesheet" href="main.css">
    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>ğŸ”’</text></svg>">
</head>
<body>
    <div class="app-container">
        <aside class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <a href="index.html" class="sidebar-logo">
                    <div class="sidebar-logo-icon">ğŸ”’</div>
                    <div class="sidebar-logo-text">Network Security<span>Ultimate Guide</span></div>
                </a>
            </div>
            <nav class="sidebar-nav">
                <div class="nav-section active">
                    <div class="nav-section-header">
                        <div class="nav-section-title"><span class="nav-section-icon">ğŸ”</span>VPN</div>
                    </div>
                    <div class="nav-section-content">
                        <a href="6-1-vpn-fundamentals.html" class="nav-link"><span class="nav-link-number">6.1</span> Fundamentals</a>
                        <a href="6-2-ipsec.html" class="nav-link"><span class="nav-link-number">6.2</span> IPSec</a>
                        <a href="6-3-ssl-vpn.html" class="nav-link"><span class="nav-link-number">6.3</span> SSL VPN</a>
                        <a href="6-4-site-to-site.html" class="nav-link active"><span class="nav-link-number">6.4</span> Site-to-Site</a>
                    </div>
                </div>
            </nav>
        </aside>
        
        <main class="main-content">
            <header class="content-header">
                <div class="header-left">
                    <button class="sidebar-toggle" id="sidebarToggle">â˜°</button>
                    <div class="breadcrumb">
                        <span class="breadcrumb-item"><a href="index.html">Home</a></span>
                        <span class="breadcrumb-separator">/</span>
                        <span class="breadcrumb-item">VPN</span>
                        <span class="breadcrumb-separator">/</span>
                        <span class="breadcrumb-current">Site-to-Site</span>
                    </div>
                </div>
            </header>
            
            <div class="content-body">
                <h1>Site-to-Site VPN</h1>
                
                <div class="overview-box">
                    <div class="overview-title">ğŸ“‹ What You'll Learn</div>
                    <div class="overview-content">
                        <p>Site-to-Site VPN connects entire networks together over the internet, creating a secure tunnel between locations. It's commonly used to connect branch offices, data centers, and cloud environments.</p>
                        <ul>
                            <li>Site-to-Site VPN concepts</li>
                            <li>Policy-based vs route-based VPN</li>
                            <li>Cloud VPN connectivity</li>
                            <li>Troubleshooting VPN tunnels</li>
                        </ul>
                    </div>
                </div>
                
                <h2>Site-to-Site VPN Architecture</h2>
                
                <div class="ascii-diagram">
                    <div class="ascii-diagram-title">Site-to-Site VPN Topology</div>
<pre>
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    SITE-TO-SITE VPN                                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚  HEADQUARTERS                              BRANCH OFFICE                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
â”‚  â”‚ Internal Network    â”‚                   â”‚ Internal Network    â”‚          â”‚
â”‚  â”‚ 10.1.0.0/16         â”‚                   â”‚ 10.2.0.0/16         â”‚          â”‚
â”‚  â”‚                     â”‚                   â”‚                     â”‚          â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â” â”Œâ”€â”€â”€â” â”Œâ”€â”€â”€â” â”‚                   â”‚  â”Œâ”€â”€â”€â” â”Œâ”€â”€â”€â” â”Œâ”€â”€â”€â” â”‚          â”‚
â”‚  â”‚  â”‚PC â”‚ â”‚Srvâ”‚ â”‚PC â”‚ â”‚                   â”‚  â”‚PC â”‚ â”‚PC â”‚ â”‚Srvâ”‚ â”‚          â”‚
â”‚  â”‚  â””â”€â”€â”€â”˜ â””â”€â”€â”€â”˜ â””â”€â”€â”€â”˜ â”‚                   â”‚  â””â”€â”€â”€â”˜ â””â”€â”€â”€â”˜ â””â”€â”€â”€â”˜ â”‚          â”‚
â”‚  â”‚         â”‚          â”‚                   â”‚         â”‚          â”‚          â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
â”‚            â”‚                                        â”‚                      â”‚
â”‚     â”Œâ”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”                          â”Œâ”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”               â”‚
â”‚     â”‚  FIREWALL   â”‚                          â”‚  FIREWALL   â”‚               â”‚
â”‚     â”‚  (VPN GW)   â”‚                          â”‚  (VPN GW)   â”‚               â”‚
â”‚     â”‚ 203.0.113.1 â”‚                          â”‚ 198.51.100.1â”‚               â”‚
â”‚     â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜                          â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜               â”‚
â”‚            â”‚                                        â”‚                      â”‚
â”‚            â”‚         â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—          â”‚                      â”‚
â”‚            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â•‘   IPSec TUNNEL    â•‘â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                      â”‚
â”‚                      â•‘   (Encrypted)     â•‘                                 â”‚
â”‚                      â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•                                 â”‚
â”‚                                â”‚                                            â”‚
â”‚                         â”Œâ”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”                                    â”‚
â”‚                         â”‚  INTERNET   â”‚                                    â”‚
â”‚                         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                    â”‚
â”‚                                                                              â”‚
â”‚  Traffic from 10.1.x.x to 10.2.x.x â†’ Encrypted through tunnel              â”‚
â”‚  Traffic from 10.1.x.x to 8.8.8.8  â†’ Normal internet (not tunneled)        â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</pre>
                </div>
                
                <h2>Policy-Based vs Route-Based VPN</h2>
                
                <div class="table-wrapper">
                    <table>
                        <thead>
                            <tr>
                                <th>Feature</th>
                                <th>Policy-Based</th>
                                <th>Route-Based</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td><strong>Traffic Selection</strong></td>
                                <td>ACL/Policy defines what's encrypted</td>
                                <td>Routing table determines tunnel traffic</td>
                            </tr>
                            <tr>
                                <td><strong>Tunnel Interface</strong></td>
                                <td>No virtual interface</td>
                                <td>Virtual tunnel interface (VTI)</td>
                            </tr>
                            <tr>
                                <td><strong>Multiple Subnets</strong></td>
                                <td>Requires multiple SAs or policies</td>
                                <td>Single tunnel, route any subnet</td>
                            </tr>
                            <tr>
                                <td><strong>Dynamic Routing</strong></td>
                                <td>Not supported</td>
                                <td>Supports OSPF, BGP over tunnel</td>
                            </tr>
                            <tr>
                                <td><strong>Failover</strong></td>
                                <td>Limited</td>
                                <td>Better (routing protocols)</td>
                            </tr>
                            <tr>
                                <td><strong>Cloud Compatibility</strong></td>
                                <td>Often problematic</td>
                                <td>Preferred for AWS, Azure, GCP</td>
                            </tr>
                            <tr>
                                <td><strong>Use Case</strong></td>
                                <td>Legacy, simple setups</td>
                                <td>Modern deployments, cloud</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
                
                <h2>Cloud VPN Connectivity</h2>
                
                <div class="ascii-diagram">
                    <div class="ascii-diagram-title">Hybrid Cloud VPN</div>
<pre>
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    HYBRID CLOUD CONNECTIVITY                                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚  ON-PREMISES                                     AWS VPC                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
â”‚  â”‚ 10.0.0.0/16         â”‚                   â”‚ 172.16.0.0/16       â”‚          â”‚
â”‚  â”‚                     â”‚                   â”‚                     â”‚          â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚                   â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚          â”‚
â”‚  â”‚  â”‚ Application â”‚    â”‚                   â”‚  â”‚ EC2         â”‚    â”‚          â”‚
â”‚  â”‚  â”‚ Servers     â”‚    â”‚                   â”‚  â”‚ Instances   â”‚    â”‚          â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚                   â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚          â”‚
â”‚  â”‚         â”‚           â”‚                   â”‚         â”‚           â”‚          â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
â”‚            â”‚                                         â”‚                      â”‚
â”‚     â”Œâ”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”                          â”Œâ”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”              â”‚
â”‚     â”‚ Customer    â”‚                          â”‚ Virtual       â”‚              â”‚
â”‚     â”‚ Gateway     â”‚â—„â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â–ºâ”‚ Private       â”‚              â”‚
â”‚     â”‚ (Firewall)  â”‚      IPSec Tunnel        â”‚ Gateway (VGW) â”‚              â”‚
â”‚     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚
â”‚                                                                              â”‚
â”‚  AWS Requirements:                                                          â”‚
â”‚  â€¢ Customer Gateway (your firewall's public IP)                            â”‚
â”‚  â€¢ Virtual Private Gateway (AWS side)                                      â”‚
â”‚  â€¢ VPN Connection (links CGW to VGW)                                       â”‚
â”‚  â€¢ Route tables updated in VPC                                             â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</pre>
                </div>
                
                <h2>VPN Troubleshooting</h2>
                
                <div class="code-block">
                    <div class="code-header">
                        <span class="code-lang">VPN Troubleshooting Commands</span>
                        <button class="code-copy-btn">ğŸ“‹ Copy</button>
                    </div>
                    <pre><code><span class="token-comment"># â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•</span>
<span class="token-comment"># PALO ALTO</span>
<span class="token-comment"># â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•</span>
<span class="token-command">show</span> vpn ike-sa                        <span class="token-comment"># Phase 1 status</span>
<span class="token-command">show</span> vpn ipsec-sa                      <span class="token-comment"># Phase 2 status</span>
<span class="token-command">show</span> vpn flow                          <span class="token-comment"># Tunnel traffic stats</span>
<span class="token-command">test</span> vpn ike-sa gateway &lt;name&gt;         <span class="token-comment"># Force Phase 1 negotiation</span>

<span class="token-comment"># â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•</span>
<span class="token-comment"># CISCO ASA</span>
<span class="token-comment"># â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•</span>
<span class="token-command">show</span> crypto isakmp sa                  <span class="token-comment"># Phase 1 status</span>
<span class="token-command">show</span> crypto ipsec sa                   <span class="token-comment"># Phase 2 status</span>
<span class="token-command">show</span> vpn-sessiondb l2l                 <span class="token-comment"># L2L tunnel summary</span>
<span class="token-command">debug</span> crypto isakmp                    <span class="token-comment"># Phase 1 debug</span>
<span class="token-command">debug</span> crypto ipsec                     <span class="token-comment"># Phase 2 debug</span>

<span class="token-comment"># â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•</span>
<span class="token-comment"># FORTINET</span>
<span class="token-comment"># â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•</span>
<span class="token-command">get</span> vpn ipsec tunnel summary           <span class="token-comment"># Tunnel summary</span>
<span class="token-command">diagnose</span> vpn ike gateway list          <span class="token-comment"># Phase 1 status</span>
<span class="token-command">diagnose</span> vpn tunnel list               <span class="token-comment"># Phase 2 status</span>
<span class="token-command">diagnose</span> debug application ike -1      <span class="token-comment"># Enable IKE debug</span>

<span class="token-comment"># â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•</span>
<span class="token-comment"># COMMON ISSUES</span>
<span class="token-comment"># â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•</span>
<span class="token-comment"># Phase 1 failures:</span>
<span class="token-comment">#   - Mismatched pre-shared key</span>
<span class="token-comment">#   - Wrong peer IP address</span>
<span class="token-comment">#   - IKE version mismatch (v1 vs v2)</span>
<span class="token-comment">#   - Proposal mismatch (encryption, hash, DH group)</span>

<span class="token-comment"># Phase 2 failures:</span>
<span class="token-comment">#   - Proxy ID / traffic selector mismatch</span>
<span class="token-comment">#   - Transform set mismatch</span>
<span class="token-comment">#   - PFS group mismatch</span>

<span class="token-comment"># Traffic not flowing:</span>
<span class="token-comment">#   - Routing not pointing to tunnel</span>
<span class="token-comment">#   - Firewall policy blocking</span>
<span class="token-comment">#   - NAT interfering with tunnel traffic</span></code></pre>
                </div>
                
                <div class="callout callout-bestpractice">
                    <div class="callout-title">âœ… Best Practice - Site-to-Site VPN</div>
                    <div class="callout-content">
                        <ul>
                            <li><strong>Use route-based VPN:</strong> More flexible, better for cloud</li>
                            <li><strong>Strong encryption:</strong> AES-256, SHA-256, DH Group 14+</li>
                            <li><strong>Redundant tunnels:</strong> Two tunnels for HA (AWS provides 2 by default)</li>
                            <li><strong>Monitor tunnel status:</strong> Alert when tunnels go down</li>
                            <li><strong>Document thoroughly:</strong> IPs, subnets, proposals on both sides</li>
                            <li><strong>Non-overlapping subnets:</strong> Ensure no IP conflicts between sites</li>
                        </ul>
                    </div>
                </div>
                
                <div class="callout callout-interview">
                    <div class="callout-title">ğŸ’¡ Interview Tip</div>
                    <div class="callout-content">
                        <p><strong>Question:</strong> "A site-to-site VPN tunnel keeps dropping. How do you troubleshoot?"</p>
                        <p><strong>Answer:</strong> "I'd start by checking Phase 1 (IKE SA) - verify peer IPs, pre-shared key, and proposals match on both sides. If Phase 1 is up, check Phase 2 (IPSec SA) - look for proxy ID/traffic selector mismatches. If both phases are up but traffic isn't flowing, verify routing points to the tunnel interface and no firewall policies are blocking. I'd also check for NAT rules that might be translating tunnel traffic incorrectly. For intermittent issues, I'd look at DPD (Dead Peer Detection) settings and rekey intervals."</p>
                    </div>
                </div>
                
                <nav class="page-navigation">
                    <a href="6-3-ssl-vpn.html" class="page-nav-btn prev">
                        <span class="page-nav-arrow">â†</span>
                        <div class="page-nav-text">
                            <span class="page-nav-label">Previous</span>
                            <span class="page-nav-title">SSL VPN</span>
                        </div>
                    </a>
                    <a href="7-1-network-segmentation.html" class="page-nav-btn next">
                        <span class="page-nav-arrow">â†’</span>
                        <div class="page-nav-text">
                            <span class="page-nav-label">Next</span>
                            <span class="page-nav-title">Network Segmentation</span>
                        </div>
                    </a>
                </nav>
            </div>
        </main>
    </div>
    <script src="main.js"></script>
</body>
</html>
