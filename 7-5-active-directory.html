<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Active Directory Security - Complete guide to securing AD, common attacks, and hardening">
    <title>Active Directory Security | Network Security Guide</title>
    <link rel="stylesheet" href="main.css">
    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>ğŸ”’</text></svg>">
</head>
<body>
    <div class="app-container">
        <aside class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <a href="index.html" class="sidebar-logo">
                    <div class="sidebar-logo-icon">ğŸ”’</div>
                    <div class="sidebar-logo-text">Network Security<span>Ultimate Guide</span></div>
                </a>
            </div>
            <nav class="sidebar-nav">
                <div class="nav-section active">
                    <div class="nav-section-header">
                        <div class="nav-section-title"><span class="nav-section-icon">ğŸ—ï¸</span>Architecture</div>
                    </div>
                    <div class="nav-section-content">
                        <a href="7-1-network-segmentation.html" class="nav-link"><span class="nav-link-number">7.1</span> Segmentation</a>
                        <a href="7-2-zero-trust.html" class="nav-link"><span class="nav-link-number">7.2</span> Zero Trust</a>
                        <a href="7-3-zscaler-platform.html" class="nav-link"><span class="nav-link-number">7.3</span> Zscaler</a>
                        <a href="7-4-threat-intel.html" class="nav-link"><span class="nav-link-number">7.4</span> Threat Intelligence</a>
                        <a href="7-5-active-directory.html" class="nav-link active"><span class="nav-link-number">7.5</span> Active Directory</a>
                    </div>
                </div>
            </nav>
        </aside>
        
        <main class="main-content">
            <header class="content-header">
                <div class="header-left">
                    <button class="sidebar-toggle" id="sidebarToggle">â˜°</button>
                    <div class="breadcrumb">
                        <span class="breadcrumb-item"><a href="index.html">Home</a></span>
                        <span class="breadcrumb-separator">/</span>
                        <span class="breadcrumb-item">Architecture</span>
                        <span class="breadcrumb-separator">/</span>
                        <span class="breadcrumb-current">Active Directory</span>
                    </div>
                </div>
            </header>
            
            <div class="content-body">
                <h1>Active Directory Security</h1>
                
                <div class="overview-box">
                    <div class="overview-title">ğŸ“‹ What You'll Learn</div>
                    <div class="overview-content">
                        <p>Active Directory (AD) is the primary target in most enterprise attacks. Compromising AD gives attackers access to everything. Understanding AD security is essential for defense.</p>
                        <ul>
                            <li>Common AD attack techniques</li>
                            <li>Privileged access tiers</li>
                            <li>Kerberos attacks and defenses</li>
                            <li>AD hardening best practices</li>
                            <li>Monitoring and detection</li>
                        </ul>
                    </div>
                </div>
                
                <h2>Common AD Attack Techniques</h2>
                
                <div class="table-wrapper">
                    <table>
                        <thead>
                            <tr>
                                <th>Attack</th>
                                <th>Description</th>
                                <th>Detection/Prevention</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td><strong>Pass-the-Hash</strong></td>
                                <td>Use NTLM hash to authenticate without password</td>
                                <td>Credential Guard, limit admin usage</td>
                            </tr>
                            <tr>
                                <td><strong>Pass-the-Ticket</strong></td>
                                <td>Steal and reuse Kerberos tickets</td>
                                <td>Short ticket lifetime, PAC validation</td>
                            </tr>
                            <tr>
                                <td><strong>Kerberoasting</strong></td>
                                <td>Request service tickets, crack offline</td>
                                <td>Strong service account passwords, AES</td>
                            </tr>
                            <tr>
                                <td><strong>AS-REP Roasting</strong></td>
                                <td>Attack accounts with pre-auth disabled</td>
                                <td>Enable pre-authentication for all</td>
                            </tr>
                            <tr>
                                <td><strong>DCSync</strong></td>
                                <td>Replicate passwords from DC</td>
                                <td>Monitor replication rights, 4662 events</td>
                            </tr>
                            <tr>
                                <td><strong>Golden Ticket</strong></td>
                                <td>Forge TGT with krbtgt hash</td>
                                <td>Rotate krbtgt password 2x, monitor</td>
                            </tr>
                            <tr>
                                <td><strong>Silver Ticket</strong></td>
                                <td>Forge service ticket with service hash</td>
                                <td>PAC validation, service account hygiene</td>
                            </tr>
                            <tr>
                                <td><strong>LLMNR/NBT-NS Poisoning</strong></td>
                                <td>Capture hashes via name resolution</td>
                                <td>Disable LLMNR/NBT-NS, use DNS</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
                
                <h2>Administrative Tier Model</h2>
                
                <div class="ascii-diagram">
                    <div class="ascii-diagram-title">Microsoft Tiered Administration Model</div>
<pre>
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    TIERED ADMINISTRATION MODEL                               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚ TIER 0 - DOMAIN ADMINS / IDENTITY                                   â”‚    â”‚
â”‚  â”‚                                                                      â”‚    â”‚
â”‚  â”‚ â€¢ Domain Controllers            â€¢ AD FS servers                     â”‚    â”‚
â”‚  â”‚ â€¢ Enterprise/Domain Admins      â€¢ PKI (Certificate Authority)       â”‚    â”‚
â”‚  â”‚ â€¢ Schema Admins                 â€¢ Azure AD Connect                  â”‚    â”‚
â”‚  â”‚                                                                      â”‚    â”‚
â”‚  â”‚ RULE: Tier 0 accounts NEVER log into Tier 1 or 2 systems           â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                              â”‚ Can manage â–¼                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚ TIER 1 - SERVER ADMINS                                              â”‚    â”‚
â”‚  â”‚                                                                      â”‚    â”‚
â”‚  â”‚ â€¢ Member servers               â€¢ Application servers                â”‚    â”‚
â”‚  â”‚ â€¢ SQL servers                  â€¢ File servers                       â”‚    â”‚
â”‚  â”‚ â€¢ Exchange servers             â€¢ Management servers                 â”‚    â”‚
â”‚  â”‚                                                                      â”‚    â”‚
â”‚  â”‚ RULE: Tier 1 accounts NEVER log into Tier 0 or 2 systems           â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                              â”‚ Can manage â–¼                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚ TIER 2 - WORKSTATION ADMINS                                         â”‚    â”‚
â”‚  â”‚                                                                      â”‚    â”‚
â”‚  â”‚ â€¢ Workstations                 â€¢ Laptops                            â”‚    â”‚
â”‚  â”‚ â€¢ Help desk access             â€¢ User devices                       â”‚    â”‚
â”‚  â”‚                                                                      â”‚    â”‚
â”‚  â”‚ RULE: Tier 2 accounts NEVER log into Tier 0 or 1 systems           â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                                              â”‚
â”‚  KEY PRINCIPLE: Credentials from a lower tier should NEVER be exposed      â”‚
â”‚                 on a higher-value tier (prevents lateral movement up)      â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</pre>
                </div>
                
                <h2>Critical Security Settings</h2>
                
                <div class="code-block">
                    <div class="code-header">
                        <span class="code-lang">PowerShell - AD Security Checks</span>
                        <button class="code-copy-btn">ğŸ“‹ Copy</button>
                    </div>
                    <pre><code><span class="token-comment"># â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•</span>
<span class="token-comment"># FIND PRIVILEGED ACCOUNTS</span>
<span class="token-comment"># â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•</span>
<span class="token-comment"># Domain Admins</span>
<span class="token-command">Get-ADGroupMember</span> -Identity "Domain Admins" -Recursive

<span class="token-comment"># Enterprise Admins</span>
<span class="token-command">Get-ADGroupMember</span> -Identity "Enterprise Admins" -Recursive

<span class="token-comment"># Accounts with DCSync rights</span>
<span class="token-command">Get-ADUser</span> -Filter * -Properties * | Where-Object {
    $_.adminCount -eq 1
} | Select-Object Name, SamAccountName

<span class="token-comment"># â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•</span>
<span class="token-comment"># FIND RISKY CONFIGURATIONS</span>
<span class="token-comment"># â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•</span>
<span class="token-comment"># Accounts with "Do not require Kerberos pre-authentication"</span>
<span class="token-command">Get-ADUser</span> -Filter {DoesNotRequirePreAuth -eq $true}

<span class="token-comment"># Accounts with "Password never expires"</span>
<span class="token-command">Get-ADUser</span> -Filter {PasswordNeverExpires -eq $true}

<span class="token-comment"># Accounts with "Store password using reversible encryption"</span>
<span class="token-command">Get-ADUser</span> -Filter {AllowReversiblePasswordEncryption -eq $true}

<span class="token-comment"># Service accounts with SPNs (Kerberoastable)</span>
<span class="token-command">Get-ADUser</span> -Filter {ServicePrincipalName -ne "$null"} -Properties ServicePrincipalName

<span class="token-comment"># â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•</span>
<span class="token-comment"># CHECK KRBTGT</span>
<span class="token-comment"># â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•</span>
<span class="token-comment"># When was krbtgt password last changed?</span>
<span class="token-command">Get-ADUser</span> krbtgt -Properties PasswordLastSet | Select-Object PasswordLastSet

<span class="token-comment"># Should be changed every 180 days (rotate twice for full reset)</span></code></pre>
                </div>
                
                <h2>AD Hardening Checklist</h2>
                
                <div class="table-wrapper">
                    <table>
                        <thead>
                            <tr>
                                <th>Category</th>
                                <th>Action</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td><strong>Privileged Access</strong></td>
                                <td>Implement tiered admin model, use PAWs for Tier 0</td>
                            </tr>
                            <tr>
                                <td><strong>Credential Protection</strong></td>
                                <td>Enable Credential Guard, LAPS for local admin</td>
                            </tr>
                            <tr>
                                <td><strong>Kerberos</strong></td>
                                <td>Require AES, disable RC4, rotate krbtgt</td>
                            </tr>
                            <tr>
                                <td><strong>Service Accounts</strong></td>
                                <td>Use gMSA, 25+ char passwords, audit SPNs</td>
                            </tr>
                            <tr>
                                <td><strong>LDAP</strong></td>
                                <td>Require LDAP signing and channel binding</td>
                            </tr>
                            <tr>
                                <td><strong>Name Resolution</strong></td>
                                <td>Disable LLMNR and NetBIOS over TCP/IP</td>
                            </tr>
                            <tr>
                                <td><strong>Monitoring</strong></td>
                                <td>Forward DC logs to SIEM, enable advanced audit</td>
                            </tr>
                            <tr>
                                <td><strong>Protected Users</strong></td>
                                <td>Add sensitive accounts to Protected Users group</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
                
                <h2>Key Event IDs for AD Monitoring</h2>
                
                <div class="table-wrapper">
                    <table>
                        <thead>
                            <tr>
                                <th>Event ID</th>
                                <th>Description</th>
                                <th>Why Monitor</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td><strong>4624</strong></td>
                                <td>Successful logon</td>
                                <td>Track admin logons to DCs</td>
                            </tr>
                            <tr>
                                <td><strong>4662</strong></td>
                                <td>Directory service object accessed</td>
                                <td>DCSync detection</td>
                            </tr>
                            <tr>
                                <td><strong>4768</strong></td>
                                <td>TGT requested (AS-REQ)</td>
                                <td>Authentication tracking</td>
                            </tr>
                            <tr>
                                <td><strong>4769</strong></td>
                                <td>Service ticket requested (TGS-REQ)</td>
                                <td>Kerberoasting detection</td>
                            </tr>
                            <tr>
                                <td><strong>4771</strong></td>
                                <td>Pre-authentication failed</td>
                                <td>Password spraying</td>
                            </tr>
                            <tr>
                                <td><strong>4776</strong></td>
                                <td>NTLM authentication</td>
                                <td>Pass-the-hash attempts</td>
                            </tr>
                            <tr>
                                <td><strong>4728/4732/4756</strong></td>
                                <td>Member added to security group</td>
                                <td>Privilege escalation</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
                
                <div class="callout callout-critical">
                    <div class="callout-title">ğŸš¨ Critical: Protect Tier 0</div>
                    <div class="callout-content">
                        <ul>
                            <li><strong>PAW (Privileged Access Workstation):</strong> Dedicated clean devices for Tier 0 admin</li>
                            <li><strong>No Internet:</strong> Tier 0 systems should not browse the web</li>
                            <li><strong>No email:</strong> Don't check email from PAWs</li>
                            <li><strong>Separate accounts:</strong> Admins need separate accounts for each tier</li>
                            <li><strong>MFA everywhere:</strong> Especially for privileged access</li>
                        </ul>
                    </div>
                </div>
                
                <div class="callout callout-interview">
                    <div class="callout-title">ğŸ’¡ Interview Tip</div>
                    <div class="callout-content">
                        <p><strong>Question:</strong> "How would you detect a Golden Ticket attack?"</p>
                        <p><strong>Answer:</strong> "Golden Ticket attacks are challenging because the forged TGT looks legitimate. Detection focuses on anomalies: Look for TGTs with unusually long lifetimes (attackers often set 10 years), TGTs without corresponding 4768 events (the TGT was forged, not requested), or account usage patterns that don't match normal behavior. Also monitor for 4769 events where the account hasn't had a recent 4768. The best defense is prevention: rotate the krbtgt password twice (since the previous hash is still valid), use short TGT lifetimes, and implement the tiered admin model so compromising a workstation doesn't give access to the krbtgt hash."</p>
                    </div>
                </div>
                
                <nav class="page-navigation">
                    <a href="7-4-threat-intel.html" class="page-nav-btn prev">
                        <span class="page-nav-arrow">â†</span>
                        <div class="page-nav-text">
                            <span class="page-nav-label">Previous</span>
                            <span class="page-nav-title">Threat Intelligence</span>
                        </div>
                    </a>
                    <a href="8-1-lb-fundamentals.html" class="page-nav-btn next">
                        <span class="page-nav-arrow">â†’</span>
                        <div class="page-nav-text">
                            <span class="page-nav-label">Next</span>
                            <span class="page-nav-title">Load Balancer Fundamentals</span>
                        </div>
                    </a>
                </nav>
            </div>
        </main>
    </div>
    <script src="main.js"></script>
</body>
</html>
