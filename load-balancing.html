<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="Load Balancing Guide - Understanding L4 vs L7, algorithm selection, health checks, and high availability patterns">
  <title>Load Balancing | NetSec Guide</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <nav class="navbar">
    <a href="index.html" class="navbar-brand">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/>
      </svg>
      NetSec Guide
    </a>
    <ul class="navbar-nav">
      <li><a href="index.html">Home</a></li>
      <li><a href="network-fundamentals.html">Fundamentals</a></li>
      <li><a href="forward-proxy.html">Proxies</a></li>
      <li><a href="firewall-concepts.html">Firewalls</a></li>
      <li><a href="troubleshooting.html">Troubleshooting</a></li>
    </ul>
    <button class="menu-toggle" aria-label="Toggle menu">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <line x1="3" y1="12" x2="21" y2="12"></line>
        <line x1="3" y1="6" x2="21" y2="6"></line>
        <line x1="3" y1="18" x2="21" y2="18"></line>
      </svg>
    </button>
  </nav>

  <aside class="sidebar">
    <div class="sidebar-section">
      <div class="sidebar-title">On This Page</div>
      <ul class="sidebar-nav">
        <li><a href="#concepts">Core Concepts</a></li>
        <li><a href="#l4-vs-l7">L4 vs L7 Decision</a></li>
        <li><a href="#algorithms">Algorithm Selection</a></li>
        <li><a href="#health-checks">Health Checks</a></li>
        <li><a href="#session">Session Persistence</a></li>
        <li><a href="#ha">High Availability</a></li>
        <li><a href="#cloud">Cloud Load Balancers</a></li>
      </ul>
    </div>
    <div class="sidebar-section">
      <div class="sidebar-title">Related Pages</div>
      <ul class="sidebar-nav">
        <li><a href="reverse-proxy.html">Reverse Proxy</a></li>
        <li><a href="cloud-networking.html">Cloud Networking</a></li>
        <li><a href="troubleshooting.html">Troubleshooting</a></li>
      </ul>
    </div>
  </aside>

  <main class="main-content">
    <div class="content-wrapper">
      <nav class="breadcrumb">
        <span class="breadcrumb-item"><a href="index.html">Home</a></span>
        <span class="breadcrumb-separator">/</span>
        <span class="breadcrumb-item active">Load Balancing</span>
      </nav>

      <h1>Load Balancing</h1>
      <p class="hero-subtitle">
        Understanding load balancing concepts, choosing the right type and algorithm, 
        and implementing high availability for your applications.
      </p>

      <!-- Core Concepts -->
      <section>
        <h2 id="concepts">Core Concepts</h2>
        <p>
          A load balancer distributes incoming traffic across multiple backend servers, 
          providing high availability, scalability, and improved performance.
        </p>

        <div class="ascii-diagram">
          <div class="ascii-diagram-title">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="3" width="18" height="18" rx="2"/></svg>
            Load Balancer Fundamentals
          </div>
          <pre>
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    HOW LOAD BALANCING WORKS                                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                             â”‚
â”‚                     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                    â”‚
â”‚   Clients â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚  LOAD BALANCER  â”‚                                    â”‚
â”‚   (many)            â”‚                 â”‚                                    â”‚
â”‚                     â”‚  â€¢ Single IP    â”‚                                    â”‚
â”‚                     â”‚  â€¢ Distributes  â”‚                                    â”‚
â”‚                     â”‚  â€¢ Health check â”‚                                    â”‚
â”‚                     â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                    â”‚
â”‚                              â”‚                                              â”‚
â”‚              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                             â”‚
â”‚              â”‚               â”‚               â”‚                             â”‚
â”‚              â–¼               â–¼               â–¼                             â”‚
â”‚        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                         â”‚
â”‚        â”‚ Server 1 â”‚   â”‚ Server 2 â”‚   â”‚ Server 3 â”‚                         â”‚
â”‚        â”‚  (25%)   â”‚   â”‚  (50%)   â”‚   â”‚  (25%)   â”‚                         â”‚
â”‚        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                         â”‚
â”‚                                                                             â”‚
â”‚   KEY BENEFITS:                                                             â”‚
â”‚   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                                             â”‚
â”‚   âœ“ High Availability - If one server fails, others handle traffic        â”‚
â”‚   âœ“ Scalability - Add servers to handle more load                          â”‚
â”‚   âœ“ Performance - Distribute load to prevent bottlenecks                   â”‚
â”‚   âœ“ Maintenance - Take servers offline without downtime                    â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          </pre>
        </div>
      </section>

      <!-- L4 vs L7 -->
      <section>
        <h2 id="l4-vs-l7">Layer 4 vs Layer 7: Which Do You Need?</h2>
        <p>
          This is the most important decision. Get this right first, and everything else follows.
        </p>

        <div class="ascii-diagram">
          <div class="ascii-diagram-title">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="3" width="18" height="18" rx="2"/></svg>
            L4 vs L7 Decision Framework
          </div>
          <pre>
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              WHICH LOAD BALANCER TYPE DO YOU NEED?                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                             â”‚
â”‚   START HERE                                                                â”‚
â”‚       â”‚                                                                     â”‚
â”‚       â–¼                                                                     â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                      â”‚
â”‚   â”‚ Is it HTTP/HTTPS web traffic?   â”‚                                      â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                      â”‚
â”‚                   â”‚                                                         â”‚
â”‚          â”Œâ”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”                                                 â”‚
â”‚          â”‚               â”‚                                                 â”‚
â”‚         YES              NO                                                â”‚
â”‚          â”‚               â”‚                                                 â”‚
â”‚          â–¼               â–¼                                                 â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                         â”‚
â”‚   â”‚ Do you need â”‚  â”‚ Use LAYER 4 (TCP/UDP)       â”‚                         â”‚
â”‚   â”‚ any of:     â”‚  â”‚                             â”‚                         â”‚
â”‚   â”‚             â”‚  â”‚ Examples:                   â”‚                         â”‚
â”‚   â”‚ â€¢ URL-based â”‚  â”‚ â€¢ Database connections      â”‚                         â”‚
â”‚   â”‚   routing   â”‚  â”‚ â€¢ Gaming servers            â”‚                         â”‚
â”‚   â”‚ â€¢ SSL term  â”‚  â”‚ â€¢ VoIP/SIP                  â”‚                         â”‚
â”‚   â”‚ â€¢ Headers   â”‚  â”‚ â€¢ Email (SMTP/IMAP)         â”‚                         â”‚
â”‚   â”‚ â€¢ Cookies   â”‚  â”‚ â€¢ Custom TCP protocols      â”‚                         â”‚
â”‚   â”‚ â€¢ Caching   â”‚  â”‚                             â”‚                         â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜  â”‚ AWS: NLB                    â”‚                         â”‚
â”‚          â”‚         â”‚ Azure: Load Balancer        â”‚                         â”‚
â”‚     â”Œâ”€â”€â”€â”€â”´â”€â”€â”€â”€â”    â”‚ GCP: TCP/UDP LB             â”‚                         â”‚
â”‚     â”‚         â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                         â”‚
â”‚    YES        NO                                                           â”‚
â”‚     â”‚         â”‚                                                            â”‚
â”‚     â–¼         â–¼                                                            â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                â”‚
â”‚ â”‚ LAYER 7 â”‚ â”‚ LAYER 4 is simpler/faster   â”‚                                â”‚
â”‚ â”‚ (HTTP)  â”‚ â”‚ Use it if you don't need    â”‚                                â”‚
â”‚ â”‚         â”‚ â”‚ L7 features                 â”‚                                â”‚
â”‚ â”‚ AWS:ALB â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                â”‚
â”‚ â”‚ Azure:  â”‚                                                                â”‚
â”‚ â”‚ AppGW   â”‚                                                                â”‚
â”‚ â”‚ GCP:    â”‚                                                                â”‚
â”‚ â”‚ HTTP LB â”‚                                                                â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                                                â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          </pre>
        </div>

        <h3>Quick Comparison</h3>
        <div class="table-wrapper">
          <table>
            <thead>
              <tr>
                <th>Aspect</th>
                <th>Layer 4 (TCP/UDP)</th>
                <th>Layer 7 (HTTP/HTTPS)</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td><strong>Sees</strong></td>
                <td>IP addresses and ports only</td>
                <td>Full HTTP request (URL, headers, body)</td>
              </tr>
              <tr>
                <td><strong>Speed</strong></td>
                <td>Faster (less processing)</td>
                <td>Slower (parses HTTP)</td>
              </tr>
              <tr>
                <td><strong>SSL</strong></td>
                <td>Pass-through only</td>
                <td>Can terminate and inspect</td>
              </tr>
              <tr>
                <td><strong>Routing</strong></td>
                <td>By port only</td>
                <td>By URL, header, cookie, hostname</td>
              </tr>
              <tr>
                <td><strong>Use When</strong></td>
                <td>Non-HTTP, need raw speed</td>
                <td>Web apps, need smart routing</td>
              </tr>
            </tbody>
          </table>
        </div>
      </section>

      <!-- Algorithms -->
      <section>
        <h2 id="algorithms">Algorithm Selection</h2>
        <p>
          The algorithm determines how traffic is distributed. Choose based on your 
          application's characteristics.
        </p>

        <div class="ascii-diagram">
          <div class="ascii-diagram-title">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="3" width="18" height="18" rx="2"/></svg>
            Which Algorithm Should You Use?
          </div>
          <pre>
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                 LOAD BALANCING ALGORITHM SELECTION                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                             â”‚
â”‚   ROUND ROBIN (Default choice)                                             â”‚
â”‚   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•                                              â”‚
â”‚   Request 1 â†’ Server A                                                     â”‚
â”‚   Request 2 â†’ Server B                                                     â”‚
â”‚   Request 3 â†’ Server C                                                     â”‚
â”‚   Request 4 â†’ Server A (repeat)                                            â”‚
â”‚                                                                             â”‚
â”‚   âœ“ Use when: Servers are identical, requests are similar in cost          â”‚
â”‚   âœ— Avoid when: Servers have different capacity, requests vary wildly      â”‚
â”‚                                                                             â”‚
â”‚   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚                                                                             â”‚
â”‚   LEAST CONNECTIONS                                                        â”‚
â”‚   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•                                                         â”‚
â”‚   Server A: 10 connections â† New request goes here (least busy)            â”‚
â”‚   Server B: 25 connections                                                 â”‚
â”‚   Server C: 18 connections                                                 â”‚
â”‚                                                                             â”‚
â”‚   âœ“ Use when: Long-lived connections (WebSockets, database pools)          â”‚
â”‚   âœ“ Use when: Request processing time varies significantly                 â”‚
â”‚   âœ— Avoid when: Connections are very short (adds overhead)                 â”‚
â”‚                                                                             â”‚
â”‚   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚                                                                             â”‚
â”‚   WEIGHTED                                                                  â”‚
â”‚   â•â•â•â•â•â•â•â•                                                                  â”‚
â”‚   Server A (weight 3): Gets 50% of traffic  â† Powerful server              â”‚
â”‚   Server B (weight 2): Gets 33% of traffic                                 â”‚
â”‚   Server C (weight 1): Gets 17% of traffic  â† Less powerful                â”‚
â”‚                                                                             â”‚
â”‚   âœ“ Use when: Servers have different capacities                            â”‚
â”‚   âœ“ Use when: Canary deployments (new version gets weight=1)               â”‚
â”‚                                                                             â”‚
â”‚   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚                                                                             â”‚
â”‚   IP HASH                                                                   â”‚
â”‚   â•â•â•â•â•â•â•                                                                   â”‚
â”‚   Client IP 1.2.3.4 â†’ Always Server A                                      â”‚
â”‚   Client IP 5.6.7.8 â†’ Always Server B                                      â”‚
â”‚                                                                             â”‚
â”‚   âœ“ Use when: Need basic session persistence without cookies               â”‚
â”‚   âœ— Avoid when: Many users behind same NAT (uneven distribution)           â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          </pre>
        </div>

        <div class="callout callout-info">
          <strong>Start Simple</strong><br>
          Begin with Round Robin. Only switch to other algorithms if you observe 
          specific problems like uneven load or session issues.
        </div>
      </section>

      <!-- Health Checks -->
      <section>
        <h2 id="health-checks">Health Checks</h2>
        <p>
          Health checks determine if a backend server can receive traffic. 
          A bad health check configuration is a common cause of outages.
        </p>

        <div class="ascii-diagram">
          <div class="ascii-diagram-title">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="3" width="18" height="18" rx="2"/></svg>
            Health Check Types
          </div>
          <pre>
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    HEALTH CHECK PROGRESSION                                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                             â”‚
â”‚   BASIC â†’ TCP (Port Open)                                                  â”‚
â”‚   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•                                                   â”‚
â”‚   LB: "Can I connect to port 8080?"                                        â”‚
â”‚   Server: [Connection accepted]                                            â”‚
â”‚   Result: HEALTHY                                                          â”‚
â”‚                                                                             â”‚
â”‚   âš ï¸  Problem: Server might accept connections but app is broken           â”‚
â”‚                                                                             â”‚
â”‚   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚                                                                             â”‚
â”‚   BETTER â†’ HTTP (Status Code)                                              â”‚
â”‚   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•                                               â”‚
â”‚   LB: "GET /health â†’ Status 200?"                                          â”‚
â”‚   Server: HTTP 200 OK                                                      â”‚
â”‚   Result: HEALTHY                                                          â”‚
â”‚                                                                             â”‚
â”‚   âš ï¸  Problem: App might return 200 but database is down                   â”‚
â”‚                                                                             â”‚
â”‚   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚                                                                             â”‚
â”‚   BEST â†’ Application Health (Deep Check)                                   â”‚
â”‚   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•                                   â”‚
â”‚   LB: "GET /health"                                                        â”‚
â”‚   App checks:                                                              â”‚
â”‚     âœ“ Database connection                                                  â”‚
â”‚     âœ“ Cache connection                                                     â”‚
â”‚     âœ“ Disk space                                                           â”‚
â”‚     âœ“ Memory available                                                     â”‚
â”‚   Server: HTTP 200 + {"status": "healthy", "db": "ok", "cache": "ok"}     â”‚
â”‚   Result: HEALTHY                                                          â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          </pre>
        </div>

        <h3>Health Check Configuration</h3>
        <div class="code-block">
          <div class="code-header">
            <span class="code-lang">Concept</span>
            <span class="code-filename">Health Check Parameters</span>
            <button class="copy-btn">Copy</button>
          </div>
          <pre><code># HEALTH CHECK PARAMETERS EXPLAINED

Interval: 30s       # How often to check
                    # Too frequent = unnecessary load
                    # Too slow = slow failure detection
                    # Recommended: 10-30 seconds

Timeout: 5s         # How long to wait for response
                    # Should be less than interval
                    # Recommended: 5-10 seconds

Healthy threshold: 2    # Consecutive successes to mark healthy
                        # Prevents flapping
                        # Recommended: 2-3

Unhealthy threshold: 3  # Consecutive failures to mark unhealthy
                        # Higher = more tolerant of blips
                        # Recommended: 2-3

# EXAMPLE HEALTHY CONFIGURATION:
interval       = 30 seconds
timeout        = 10 seconds
healthy_after  = 2 consecutive successes
unhealthy_after = 3 consecutive failures
path           = /health
expected       = HTTP 200</code></pre>
        </div>

        <div class="callout callout-warning">
          <strong>Health Check Endpoint Best Practices</strong><br>
          â€¢ Create a dedicated <code>/health</code> endpoint (don't use <code>/</code>)<br>
          â€¢ Check actual dependencies (database, cache) not just "app is running"<br>
          â€¢ Keep it fast (&lt;1 second) to avoid timeout issues<br>
          â€¢ Return JSON with details for debugging
        </div>
      </section>

      <!-- Session Persistence -->
      <section>
        <h2 id="session">Session Persistence (Sticky Sessions)</h2>
        <p>
          Session persistence ensures a user's requests always go to the same server. 
          <strong>Use sparingly</strong> â€” it can cause uneven load distribution.
        </p>

        <div class="ascii-diagram">
          <div class="ascii-diagram-title">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="3" width="18" height="18" rx="2"/></svg>
            When to Use Session Persistence
          </div>
          <pre>
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  DO YOU NEED SESSION PERSISTENCE?                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                             â”‚
â”‚   START HERE                                                                â”‚
â”‚       â”‚                                                                     â”‚
â”‚       â–¼                                                                     â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                  â”‚
â”‚   â”‚ Does your app store session state   â”‚                                  â”‚
â”‚   â”‚ locally on the server?              â”‚                                  â”‚
â”‚   â”‚ (files, memory, local cache)        â”‚                                  â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                  â”‚
â”‚                       â”‚                                                     â”‚
â”‚              â”Œâ”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”                                             â”‚
â”‚              â”‚               â”‚                                             â”‚
â”‚             YES              NO                                            â”‚
â”‚              â”‚               â”‚                                             â”‚
â”‚              â–¼               â–¼                                             â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                 â”‚
â”‚   â”‚ Can you move    â”‚  â”‚ You DON'T need sticky sessions! â”‚                 â”‚
â”‚   â”‚ state to shared â”‚  â”‚                                 â”‚                 â”‚
â”‚   â”‚ storage?        â”‚  â”‚ Stateless apps scale better     â”‚                 â”‚
â”‚   â”‚ (Redis, DB)     â”‚  â”‚ and are more resilient.         â”‚                 â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                 â”‚
â”‚            â”‚                                                                â”‚
â”‚       â”Œâ”€â”€â”€â”€â”´â”€â”€â”€â”€â”                                                          â”‚
â”‚       â”‚         â”‚                                                          â”‚
â”‚      YES        NO (legacy/constraints)                                    â”‚
â”‚       â”‚         â”‚                                                          â”‚
â”‚       â–¼         â–¼                                                          â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                         â”‚
â”‚   â”‚ Do it!  â”‚  â”‚ Use sticky sessions as a        â”‚                         â”‚
â”‚   â”‚ No      â”‚  â”‚ WORKAROUND, not a solution.     â”‚                         â”‚
â”‚   â”‚ sticky  â”‚  â”‚                                 â”‚                         â”‚
â”‚   â”‚ needed  â”‚  â”‚ Methods:                        â”‚                         â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚ â€¢ Cookie-based (most reliable)  â”‚                         â”‚
â”‚                â”‚ â€¢ IP-based (breaks with NAT)    â”‚                         â”‚
â”‚                â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                         â”‚
â”‚                                                                             â”‚
â”‚   âš ï¸ WARNING: Sticky sessions cause:                                       â”‚
â”‚   â€¢ Uneven load when some users are "heavier"                              â”‚
â”‚   â€¢ Cascading failures when sticky server dies                             â”‚
â”‚   â€¢ Difficulty scaling and doing deployments                               â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          </pre>
        </div>
      </section>

      <!-- High Availability -->
      <section>
        <h2 id="ha">High Availability Patterns</h2>

        <div class="ascii-diagram">
          <div class="ascii-diagram-title">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="3" width="18" height="18" rx="2"/></svg>
            Load Balancer HA Patterns
          </div>
          <pre>
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                 LOAD BALANCER HIGH AVAILABILITY                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                             â”‚
â”‚   PATTERN 1: ACTIVE-PASSIVE (Simpler)                                      â”‚
â”‚   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•                                      â”‚
â”‚                                                                             â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     Heartbeat      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                     â”‚
â”‚   â”‚   ACTIVE     â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚   PASSIVE    â”‚                     â”‚
â”‚   â”‚  LB (VIP)    â”‚                    â”‚   LB (idle)  â”‚                     â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                     â”‚
â”‚          â”‚                                    â”‚                             â”‚
â”‚          â”‚ â† All traffic                      â”‚ (takes over if             â”‚
â”‚          â–¼                                    â”‚  active fails)             â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                                         â”‚
â”‚   â”‚   Servers    â”‚                                                         â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                                         â”‚
â”‚                                                                             â”‚
â”‚   âœ“ Simple to understand and troubleshoot                                  â”‚
â”‚   âœ— Passive LB is wasted capacity                                          â”‚
â”‚                                                                             â”‚
â”‚   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚                                                                             â”‚
â”‚   PATTERN 2: ACTIVE-ACTIVE (Better utilization)                            â”‚
â”‚   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•                            â”‚
â”‚                                                                             â”‚
â”‚          DNS Round Robin or BGP Anycast                                    â”‚
â”‚                     â”‚                                                       â”‚
â”‚          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                             â”‚
â”‚          â–¼                   â–¼                                             â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                     â”‚
â”‚   â”‚    LB 1      â”‚    â”‚    LB 2      â”‚                                     â”‚
â”‚   â”‚  (50% traffic)â”‚   â”‚  (50% traffic)â”‚                                    â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜                                     â”‚
â”‚          â”‚                   â”‚                                              â”‚
â”‚          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                             â”‚
â”‚                    â–¼                                                        â”‚
â”‚            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                                â”‚
â”‚            â”‚   Servers    â”‚                                                â”‚
â”‚            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                                â”‚
â”‚                                                                             â”‚
â”‚   âœ“ Both LBs actively serving traffic                                      â”‚
â”‚   âœ“ Better resource utilization                                            â”‚
â”‚   âœ— More complex (need session sync or stateless design)                   â”‚
â”‚                                                                             â”‚
â”‚   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚                                                                             â”‚
â”‚   CLOUD PROVIDER APPROACH: Managed & Multi-AZ                              â”‚
â”‚   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•                             â”‚
â”‚                                                                             â”‚
â”‚   Just use AWS ALB/NLB, Azure LB, or GCP LB.                               â”‚
â”‚   They handle HA automatically across availability zones.                   â”‚
â”‚   You don't manage the LB nodes at all.                                    â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          </pre>
        </div>
      </section>

      <!-- Cloud Load Balancers -->
      <section>
        <h2 id="cloud">Cloud Load Balancers</h2>
        <p>
          Each cloud provider has multiple load balancer types. Here's how to choose.
        </p>

        <h3>Quick Reference</h3>
        <div class="table-wrapper">
          <table>
            <thead>
              <tr>
                <th>Use Case</th>
                <th>AWS</th>
                <th>Azure</th>
                <th>GCP</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td><strong>HTTP/HTTPS apps</strong></td>
                <td>ALB (Application LB)</td>
                <td>Application Gateway</td>
                <td>HTTP(S) Load Balancer</td>
              </tr>
              <tr>
                <td><strong>TCP/UDP (non-HTTP)</strong></td>
                <td>NLB (Network LB)</td>
                <td>Azure Load Balancer</td>
                <td>TCP/UDP Load Balancer</td>
              </tr>
              <tr>
                <td><strong>Global (multi-region)</strong></td>
                <td>Global Accelerator</td>
                <td>Front Door</td>
                <td>Global HTTP(S) LB</td>
              </tr>
              <tr>
                <td><strong>Internal only</strong></td>
                <td>Internal ALB/NLB</td>
                <td>Internal LB</td>
                <td>Internal HTTP(S)/TCP LB</td>
              </tr>
            </tbody>
          </table>
        </div>

        <h3>Minimal Configuration Pattern</h3>
        <p>All cloud load balancers follow the same basic structure:</p>

        <div class="code-block">
          <div class="code-header">
            <span class="code-lang">Concept</span>
            <span class="code-filename">Universal LB Structure</span>
            <button class="copy-btn">Copy</button>
          </div>
          <pre><code># EVERY LOAD BALANCER HAS THESE COMPONENTS:

1. LISTENER
   - What port/protocol to accept traffic on
   - Example: HTTPS on port 443

2. TARGET GROUP / BACKEND POOL
   - Where to send traffic
   - Contains your servers (by IP or instance ID)
   - Example: web-servers-prod

3. HEALTH CHECK
   - How to verify targets are healthy
   - Example: HTTP GET /health expecting 200

4. RULES (L7 only)
   - How to route different requests
   - Example: /api/* â†’ api-servers, /* â†’ web-servers</code></pre>
        </div>

        <div class="tabs">
          <div class="tab-list">
            <button class="tab-btn active" data-tab="aws-lb">AWS ALB</button>
            <button class="tab-btn" data-tab="azure-lb">Azure</button>
            <button class="tab-btn" data-tab="gcp-lb">GCP</button>
          </div>

          <div class="tab-content active" id="aws-lb">
            <div class="code-block">
              <div class="code-header">
                <span class="code-lang">Terraform</span>
                <span class="code-filename">AWS ALB - Essential Components</span>
                <button class="copy-btn">Copy</button>
              </div>
              <pre><code># AWS ALB - Minimal viable configuration
# Full docs: docs.aws.amazon.com/elasticloadbalancing/

# 1. The Load Balancer itself
resource "aws_lb" "main" {
  name               = "my-app-alb"
  load_balancer_type = "application"    # Use "network" for NLB
  subnets            = var.public_subnet_ids
  security_groups    = [aws_security_group.alb.id]
}

# 2. Target Group (where traffic goes)
resource "aws_lb_target_group" "main" {
  name     = "my-app-targets"
  port     = 8080
  protocol = "HTTP"
  vpc_id   = var.vpc_id

  health_check {
    path                = "/health"
    healthy_threshold   = 2
    unhealthy_threshold = 3
    interval            = 30
  }
}

# 3. Listener (what traffic to accept)
resource "aws_lb_listener" "https" {
  load_balancer_arn = aws_lb.main.arn
  port              = 443
  protocol          = "HTTPS"
  certificate_arn   = var.certificate_arn

  default_action {
    type             = "forward"
    target_group_arn = aws_lb_target_group.main.arn
  }
}

# Add servers to target group via:
# - aws_lb_target_group_attachment (for EC2)
# - Auto Scaling Group target_group_arns</code></pre>
            </div>
          </div>

          <div class="tab-content" id="azure-lb">
            <div class="code-block">
              <div class="code-header">
                <span class="code-lang">Concept</span>
                <span class="code-filename">Azure Application Gateway - Key Settings</span>
                <button class="copy-btn">Copy</button>
              </div>
              <pre><code># Azure Application Gateway - What to configure
# Full docs: docs.microsoft.com/azure/application-gateway/

REQUIRED COMPONENTS:

1. Application Gateway resource
   - SKU: Standard_v2 or WAF_v2
   - Subnet: Dedicated subnet for AppGW

2. Frontend IP Configuration
   - Public IP for internet-facing
   - Private IP for internal

3. Backend Pool
   - Your VMs, VMSS, or App Services
   - Can mix different target types

4. HTTP Settings
   - Backend port and protocol
   - Cookie affinity (sticky sessions)
   - Connection draining

5. Health Probe
   - Path: /health
   - Interval: 30 seconds
   - Unhealthy threshold: 3

6. Listener
   - Frontend IP + Port
   - HTTP or HTTPS (with cert)

7. Request Routing Rule
   - Links: Listener â†’ Backend Pool
   - Optional path-based routing</code></pre>
            </div>
          </div>

          <div class="tab-content" id="gcp-lb">
            <div class="code-block">
              <div class="code-header">
                <span class="code-lang">Concept</span>
                <span class="code-filename">GCP HTTP(S) LB - Key Components</span>
                <button class="copy-btn">Copy</button>
              </div>
              <pre><code># GCP HTTP(S) Load Balancer - What to configure
# Full docs: cloud.google.com/load-balancing/docs

REQUIRED COMPONENTS:

1. Backend Service
   - Points to instance groups or NEGs
   - Health check attached
   - Session affinity (optional)

2. Health Check
   - Protocol: HTTP/HTTPS/TCP
   - Port and path
   - Check interval and thresholds

3. URL Map
   - Default backend service
   - Path rules (optional)
   - Host rules (optional)

4. Target Proxy
   - HTTP: Target HTTP Proxy
   - HTTPS: Target HTTPS Proxy + SSL cert

5. Forwarding Rule
   - External IP (or internal)
   - Port: 80, 443
   - Links to target proxy

GCP DIFFERENCE: Components are more granular.
External IP â†’ Forwarding Rule â†’ Proxy â†’ URL Map â†’ Backend Service â†’ Instances</code></pre>
            </div>
          </div>
        </div>
      </section>

      <!-- Quick Reference -->
      <section>
        <h2>Common Gotchas</h2>

        <div class="card-grid">
          <div class="card">
            <h4>ğŸš« Health Check on "/"</h4>
            <p>Your homepage might be slow or have dependencies. Use a dedicated <code>/health</code> endpoint.</p>
          </div>
          <div class="card">
            <h4>ğŸš« Timeout Mismatches</h4>
            <p>LB timeout must be longer than app timeout. If app takes 30s, LB needs 35s+.</p>
          </div>
          <div class="card">
            <h4>ğŸš« Security Group Gaps</h4>
            <p>Backend servers must allow traffic FROM the load balancer, not just from users.</p>
          </div>
          <div class="card">
            <h4>ğŸš« Wrong LB Type</h4>
            <p>Using L7 for database connections or L4 when you need URL routing. Match to your protocol.</p>
          </div>
          <div class="card">
            <h4>ğŸš« Sticky + AutoScale</h4>
            <p>Sticky sessions + auto-scaling = new servers get no traffic. Design stateless instead.</p>
          </div>
          <div class="card">
            <h4>ğŸš« No Connection Draining</h4>
            <p>Enable draining before removing servers. Gives in-flight requests time to complete.</p>
          </div>
        </div>
      </section>

      <section>
        <div class="section-divider"><span>Related Guides</span></div>
        <div class="card-grid">
          <a href="reverse-proxy.html" class="nav-card card">
            <h4>Reverse Proxy â†’</h4>
            <p>Nginx, HAProxy configuration.</p>
          </a>
          <a href="cloud-networking.html" class="nav-card card">
            <h4>Cloud Networking â†’</h4>
            <p>VPC, subnets, security groups.</p>
          </a>
          <a href="troubleshooting.html" class="nav-card card">
            <h4>Troubleshooting â†’</h4>
            <p>Diagnosing LB issues.</p>
          </a>
        </div>
      </section>

    </div>
  </main>

  <footer class="footer">
    <div class="footer-bottom">
      <p>Network Security & Infrastructure Guide</p>
    </div>
  </footer>

  <script src="main.js"></script>
</body>
</html>
