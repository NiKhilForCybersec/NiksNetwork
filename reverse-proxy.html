<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="Reverse Proxy Complete Guide - Nginx, HAProxy, Apache, F5, Traefik configurations for load balancing, SSL termination, and caching">
  <title>Reverse Proxy Guide | NetSec Guide</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <!-- Navigation Bar -->
  <nav class="navbar">
    <a href="index.html" class="navbar-brand">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/>
      </svg>
      NetSec Guide
    </a>
    <ul class="navbar-nav">
      <li><a href="index.html">Home</a></li>
      <li><a href="network-fundamentals.html">Fundamentals</a></li>
      <li><a href="forward-proxy.html" class="active">Proxies</a></li>
      <li><a href="firewall-concepts.html">Firewalls</a></li>
      <li><a href="troubleshooting.html">Troubleshooting</a></li>
    </ul>
    <button class="menu-toggle" aria-label="Toggle menu">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <line x1="3" y1="12" x2="21" y2="12"></line>
        <line x1="3" y1="6" x2="21" y2="6"></line>
        <line x1="3" y1="18" x2="21" y2="18"></line>
      </svg>
    </button>
  </nav>

  <!-- Sidebar -->
  <aside class="sidebar">
    <div class="sidebar-section">
      <div class="sidebar-title">On This Page</div>
      <ul class="sidebar-nav">
        <li><a href="#concepts">Reverse Proxy Concepts</a></li>
        <li><a href="#use-cases">Use Cases</a></li>
        <li><a href="#nginx">Nginx</a></li>
        <li><a href="#haproxy">HAProxy</a></li>
        <li><a href="#apache">Apache mod_proxy</a></li>
        <li><a href="#traefik">Traefik</a></li>
        <li><a href="#comparison">Comparison</a></li>
      </ul>
    </div>
    <div class="sidebar-section">
      <div class="sidebar-title">Related Pages</div>
      <ul class="sidebar-nav">
        <li><a href="forward-proxy.html">Forward Proxy</a></li>
        <li><a href="load-balancing.html">Load Balancing</a></li>
        <li><a href="waf.html">WAF</a></li>
      </ul>
    </div>
  </aside>

  <!-- Main Content -->
  <main class="main-content">
    <div class="content-wrapper">
      <nav class="breadcrumb">
        <span class="breadcrumb-item"><a href="index.html">Home</a></span>
        <span class="breadcrumb-separator">/</span>
        <span class="breadcrumb-item active">Reverse Proxy</span>
      </nav>

      <h1>Reverse Proxy - Complete Guide</h1>
      <p class="hero-subtitle">
        Master reverse proxy technologies for load balancing, SSL termination, caching, and 
        security. Comprehensive coverage of Nginx, HAProxy, Apache, Traefik, and enterprise solutions.
      </p>

      <!-- Concepts -->
      <section>
        <h2 id="concepts">What is a Reverse Proxy?</h2>
        <p>
          A reverse proxy sits in front of backend servers, receiving client requests and 
          forwarding them to appropriate servers. It hides server infrastructure from clients 
          and provides load balancing, caching, SSL termination, and security.
        </p>

        <div class="ascii-diagram">
          <div class="ascii-diagram-title">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="3" width="18" height="18" rx="2"/></svg>
            Reverse Proxy Architecture
          </div>
          <pre>
                                                            INTERNAL NETWORK
     INTERNET                                               (Hidden from clients)
                                                    │
  ┌─────────────┐                                   │    ┌─────────────────────────┐
  │   Client    │                                   │    │    Web Server 1         │
  │  Browser    │────┐                              │    │    192.168.1.10:8080    │
  └─────────────┘    │                              │ ┌─►│    (Apache/Tomcat)      │
                     │                              │ │  └─────────────────────────┘
  ┌─────────────┐    │    ┌─────────────────────┐   │ │
  │   Client    │    │    │                     │   │ │  ┌─────────────────────────┐
  │   Mobile    │────┼───►│   REVERSE PROXY     │───┼─┼─►│    Web Server 2         │
  └─────────────┘    │    │   (Nginx/HAProxy)   │   │ │  │    192.168.1.11:8080    │
                     │    │                     │   │ │  │    (Apache/Tomcat)      │
  ┌─────────────┐    │    │   Public IP:        │   │ │  └─────────────────────────┘
  │   Client    │    │    │   203.0.113.100     │   │ │
  │    API      │────┘    │                     │   │ │  ┌─────────────────────────┐
  └─────────────┘         │   Functions:        │   │ └─►│    Web Server 3         │
                          │   • Load Balancing  │   │    │    192.168.1.12:8080    │
        Clients only      │   • SSL Termination │   │    │    (Apache/Tomcat)      │
        see: 203.0.113.100│   • Caching         │   │    └─────────────────────────┘
                          │   • Compression     │   │
                          │   • Security        │   │    ┌─────────────────────────┐
                          └─────────────────────┘   │    │    API Server           │
                                                    │    │    192.168.1.20:3000    │
                                                    └───►│    (Node.js)            │
                                                         └─────────────────────────┘
          </pre>
        </div>
      </section>

      <!-- Use Cases -->
      <section>
        <h2 id="use-cases">Reverse Proxy Use Cases</h2>

        <div class="card-grid">
          <div class="card">
            <div class="card-header">
              <div class="card-icon">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="2" y="3" width="20" height="14" rx="2" ry="2"/><line x1="8" y1="21" x2="16" y2="21"/><line x1="12" y1="17" x2="12" y2="21"/></svg>
              </div>
              <h4 class="card-title">Load Balancing</h4>
            </div>
            <div class="card-body">
              <p>Distribute traffic across multiple backend servers for high availability and scalability using various algorithms.</p>
            </div>
          </div>

          <div class="card">
            <div class="card-header">
              <div class="card-icon">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="11" width="18" height="11" rx="2" ry="2"/><path d="M7 11V7a5 5 0 0 1 10 0v4"/></svg>
              </div>
              <h4 class="card-title">SSL/TLS Termination</h4>
            </div>
            <div class="card-body">
              <p>Handle HTTPS encryption/decryption at the proxy, offloading CPU-intensive cryptographic operations from backend servers.</p>
            </div>
          </div>

          <div class="card">
            <div class="card-header">
              <div class="card-icon">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z"/></svg>
              </div>
              <h4 class="card-title">Caching</h4>
            </div>
            <div class="card-body">
              <p>Cache static content and API responses to reduce backend load and improve response times for clients.</p>
            </div>
          </div>

          <div class="card">
            <div class="card-header">
              <div class="card-icon">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/></svg>
              </div>
              <h4 class="card-title">Security</h4>
            </div>
            <div class="card-body">
              <p>Hide backend server IPs, add security headers, rate limiting, and integrate with WAF for application protection.</p>
            </div>
          </div>
        </div>
      </section>

      <!-- Nginx -->
      <section>
        <h2 id="nginx">Nginx Reverse Proxy</h2>
        <p>
          Nginx is a high-performance web server and reverse proxy known for its stability, 
          rich feature set, and low resource consumption.
        </p>

        <h3>Basic Reverse Proxy</h3>
        <div class="code-block">
          <div class="code-header">
            <span class="code-lang">Nginx</span>
            <span class="code-filename">/etc/nginx/sites-available/app.conf</span>
            <button class="copy-btn">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="9" y="9" width="13" height="13" rx="2" ry="2"/><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"/></svg>
              Copy
            </button>
          </div>
          <pre><code># =============================================================================
# NGINX REVERSE PROXY - BASIC CONFIGURATION
# =============================================================================

upstream backend_servers {
    # Round-robin load balancing (default)
    server 192.168.1.10:8080 weight=3;
    server 192.168.1.11:8080 weight=2;
    server 192.168.1.12:8080 weight=1;
    
    # Backup server (used when others are down)
    server 192.168.1.13:8080 backup;
    
    # Health check parameters
    keepalive 32;
}

server {
    listen 80;
    server_name app.example.com;
    
    # Redirect HTTP to HTTPS
    return 301 https://$server_name$request_uri;
}

server {
    listen 443 ssl http2;
    server_name app.example.com;
    
    # SSL Configuration
    ssl_certificate /etc/nginx/ssl/app.example.com.crt;
    ssl_certificate_key /etc/nginx/ssl/app.example.com.key;
    ssl_protocols TLSv1.2 TLSv1.3;
    ssl_ciphers ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES128-GCM-SHA256;
    ssl_prefer_server_ciphers on;
    ssl_session_cache shared:SSL:10m;
    ssl_session_timeout 10m;
    
    # Security Headers
    add_header X-Frame-Options "SAMEORIGIN" always;
    add_header X-Content-Type-Options "nosniff" always;
    add_header X-XSS-Protection "1; mode=block" always;
    add_header Strict-Transport-Security "max-age=31536000; includeSubDomains" always;
    
    # Logging
    access_log /var/log/nginx/app.access.log;
    error_log /var/log/nginx/app.error.log;
    
    # Proxy to backend
    location / {
        proxy_pass http://backend_servers;
        
        # Proxy headers
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
        
        # Timeouts
        proxy_connect_timeout 60s;
        proxy_send_timeout 60s;
        proxy_read_timeout 60s;
        
        # Buffer settings
        proxy_buffering on;
        proxy_buffer_size 4k;
        proxy_buffers 8 4k;
        
        # WebSocket support
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection "upgrade";
    }
    
    # Static files - serve directly
    location /static/ {
        alias /var/www/app/static/;
        expires 30d;
        add_header Cache-Control "public, immutable";
    }
    
    # API routing
    location /api/ {
        proxy_pass http://192.168.1.20:3000/;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
    }
    
    # Health check endpoint
    location /health {
        access_log off;
        return 200 "OK\n";
        add_header Content-Type text/plain;
    }
}</code></pre>
        </div>

        <h3>Nginx Load Balancing Algorithms</h3>
        <div class="code-block">
          <div class="code-header">
            <span class="code-lang">Nginx</span>
            <span class="code-filename">Load Balancing Methods</span>
            <button class="copy-btn">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="9" y="9" width="13" height="13" rx="2" ry="2"/><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"/></svg>
              Copy
            </button>
          </div>
          <pre><code># =============================================================================
# LOAD BALANCING ALGORITHMS
# =============================================================================

# 1. ROUND ROBIN (Default)
# Requests distributed sequentially
upstream round_robin {
    server 192.168.1.10:8080;
    server 192.168.1.11:8080;
    server 192.168.1.12:8080;
}

# 2. WEIGHTED ROUND ROBIN
# Higher weight = more requests
upstream weighted {
    server 192.168.1.10:8080 weight=5;  # 50% of traffic
    server 192.168.1.11:8080 weight=3;  # 30% of traffic
    server 192.168.1.12:8080 weight=2;  # 20% of traffic
}

# 3. LEAST CONNECTIONS
# Routes to server with fewest active connections
upstream least_conn {
    least_conn;
    server 192.168.1.10:8080;
    server 192.168.1.11:8080;
    server 192.168.1.12:8080;
}

# 4. IP HASH (Session Persistence)
# Same client IP always goes to same server
upstream ip_hash {
    ip_hash;
    server 192.168.1.10:8080;
    server 192.168.1.11:8080;
    server 192.168.1.12:8080;
}

# 5. HASH (Custom Key)
# Consistent hashing based on specified key
upstream hash_uri {
    hash $request_uri consistent;
    server 192.168.1.10:8080;
    server 192.168.1.11:8080;
    server 192.168.1.12:8080;
}

# 6. RANDOM
# Random server selection with optional two-choices
upstream random_lb {
    random two least_conn;
    server 192.168.1.10:8080;
    server 192.168.1.11:8080;
    server 192.168.1.12:8080;
}

# =============================================================================
# SERVER PARAMETERS
# =============================================================================

upstream with_params {
    server 192.168.1.10:8080 weight=3 max_fails=3 fail_timeout=30s;
    server 192.168.1.11:8080 weight=2 max_conns=100;
    server 192.168.1.12:8080 backup;           # Only used when others fail
    server 192.168.1.13:8080 down;             # Marked as permanently down
    
    # Keep persistent connections
    keepalive 32;
    keepalive_requests 100;
    keepalive_timeout 60s;
}</code></pre>
        </div>

        <h3>Nginx Caching Configuration</h3>
        <div class="code-block">
          <div class="code-header">
            <span class="code-lang">Nginx</span>
            <span class="code-filename">Proxy Cache Configuration</span>
            <button class="copy-btn">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="9" y="9" width="13" height="13" rx="2" ry="2"/><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"/></svg>
              Copy
            </button>
          </div>
          <pre><code># =============================================================================
# PROXY CACHING CONFIGURATION
# =============================================================================

# Define cache zone in http block
http {
    # Cache path configuration
    proxy_cache_path /var/cache/nginx 
        levels=1:2 
        keys_zone=app_cache:100m 
        max_size=10g 
        inactive=60m 
        use_temp_path=off;
    
    # Cache status header (for debugging)
    add_header X-Cache-Status $upstream_cache_status;
}

server {
    listen 443 ssl http2;
    server_name app.example.com;
    
    location / {
        proxy_pass http://backend_servers;
        
        # Enable caching
        proxy_cache app_cache;
        proxy_cache_valid 200 302 10m;
        proxy_cache_valid 404 1m;
        proxy_cache_valid any 5m;
        
        # Cache key
        proxy_cache_key $scheme$request_method$host$request_uri;
        
        # Bypass cache conditions
        proxy_cache_bypass $http_cache_control;
        proxy_no_cache $http_pragma $http_authorization;
        
        # Serve stale content while updating
        proxy_cache_use_stale error timeout updating http_500 http_502 http_503 http_504;
        proxy_cache_background_update on;
        proxy_cache_lock on;
        
        # Minimum uses before caching
        proxy_cache_min_uses 2;
    }
    
    # Static content with aggressive caching
    location ~* \.(jpg|jpeg|png|gif|ico|css|js|woff2)$ {
        proxy_pass http://backend_servers;
        proxy_cache app_cache;
        proxy_cache_valid 200 30d;
        expires 30d;
        add_header Cache-Control "public, immutable";
    }
    
    # API endpoints - no caching
    location /api/ {
        proxy_pass http://api_servers;
        proxy_cache off;
        add_header Cache-Control "no-store, no-cache, must-revalidate";
    }
    
    # Cache purge (requires ngx_cache_purge module)
    location ~ /purge(/.*) {
        allow 192.168.1.0/24;
        deny all;
        proxy_cache_purge app_cache $scheme$request_method$host$1;
    }
}</code></pre>
        </div>
      </section>

      <!-- HAProxy -->
      <section>
        <h2 id="haproxy">HAProxy</h2>
        <p>
          HAProxy is a high-performance TCP/HTTP load balancer and proxy server known for 
          its reliability and advanced features.
        </p>

        <h3>Complete HAProxy Configuration</h3>
        <div class="code-block">
          <div class="code-header">
            <span class="code-lang">HAProxy</span>
            <span class="code-filename">/etc/haproxy/haproxy.cfg</span>
            <button class="copy-btn">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="9" y="9" width="13" height="13" rx="2" ry="2"/><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"/></svg>
              Copy
            </button>
          </div>
          <pre><code># =============================================================================
# HAPROXY CONFIGURATION
# =============================================================================

#------------------------------------------------------------------------------
# Global Settings
#------------------------------------------------------------------------------
global
    log /dev/log local0
    log /dev/log local1 notice
    chroot /var/lib/haproxy
    stats socket /run/haproxy/admin.sock mode 660 level admin
    stats timeout 30s
    user haproxy
    group haproxy
    daemon
    
    # SSL settings
    ssl-default-bind-ciphers ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES128-GCM-SHA256
    ssl-default-bind-options ssl-min-ver TLSv1.2 no-tls-tickets
    tune.ssl.default-dh-param 2048
    
    # Performance tuning
    maxconn 50000
    tune.bufsize 32768

#------------------------------------------------------------------------------
# Default Settings
#------------------------------------------------------------------------------
defaults
    log     global
    mode    http
    option  httplog
    option  dontlognull
    option  forwardfor
    option  http-server-close
    
    timeout connect 5s
    timeout client  30s
    timeout server  30s
    timeout http-request 10s
    timeout http-keep-alive 10s
    timeout queue 30s
    
    # Error files
    errorfile 400 /etc/haproxy/errors/400.http
    errorfile 403 /etc/haproxy/errors/403.http
    errorfile 408 /etc/haproxy/errors/408.http
    errorfile 500 /etc/haproxy/errors/500.http
    errorfile 502 /etc/haproxy/errors/502.http
    errorfile 503 /etc/haproxy/errors/503.http
    errorfile 504 /etc/haproxy/errors/504.http

#------------------------------------------------------------------------------
# Statistics Page
#------------------------------------------------------------------------------
frontend stats
    bind *:8404
    mode http
    stats enable
    stats uri /stats
    stats refresh 10s
    stats admin if LOCALHOST
    stats auth admin:SecurePassword123!

#------------------------------------------------------------------------------
# HTTP Frontend (Redirect to HTTPS)
#------------------------------------------------------------------------------
frontend http_front
    bind *:80
    mode http
    
    # Redirect all HTTP to HTTPS
    http-request redirect scheme https unless { ssl_fc }

#------------------------------------------------------------------------------
# HTTPS Frontend
#------------------------------------------------------------------------------
frontend https_front
    bind *:443 ssl crt /etc/haproxy/certs/combined.pem alpn h2,http/1.1
    mode http
    
    # Request headers
    http-request set-header X-Forwarded-Proto https
    http-request set-header X-Real-IP %[src]
    
    # Security headers
    http-response set-header X-Frame-Options SAMEORIGIN
    http-response set-header X-Content-Type-Options nosniff
    http-response set-header X-XSS-Protection "1; mode=block"
    http-response set-header Strict-Transport-Security "max-age=31536000"
    
    # ACLs for routing
    acl is_api path_beg /api/
    acl is_static path_beg /static/ /images/ /css/ /js/
    acl is_websocket hdr(Upgrade) -i websocket
    acl is_admin path_beg /admin/
    acl admin_network src 192.168.10.0/24
    
    # Rate limiting
    stick-table type ip size 100k expire 30s store http_req_rate(10s)
    http-request track-sc0 src
    http-request deny deny_status 429 if { sc_http_req_rate(0) gt 100 }
    
    # Routing rules
    use_backend api_servers if is_api
    use_backend static_servers if is_static
    use_backend websocket_servers if is_websocket
    use_backend admin_servers if is_admin admin_network
    http-request deny if is_admin !admin_network
    
    # Default backend
    default_backend web_servers

#------------------------------------------------------------------------------
# Web Application Backend
#------------------------------------------------------------------------------
backend web_servers
    mode http
    balance roundrobin
    option httpchk GET /health HTTP/1.1\r\nHost:\ localhost
    http-check expect status 200
    
    # Cookie-based session persistence
    cookie SERVERID insert indirect nocache
    
    # Servers
    server web1 192.168.1.10:8080 check cookie web1 weight 3
    server web2 192.168.1.11:8080 check cookie web2 weight 2
    server web3 192.168.1.12:8080 check cookie web3 weight 1
    server web4 192.168.1.13:8080 check backup

#------------------------------------------------------------------------------
# API Backend
#------------------------------------------------------------------------------
backend api_servers
    mode http
    balance leastconn
    option httpchk GET /api/health HTTP/1.1\r\nHost:\ localhost
    http-check expect status 200
    
    # API timeout adjustments
    timeout server 60s
    timeout queue 60s
    
    # Retry on connection failure
    option redispatch
    retries 3
    
    server api1 192.168.1.20:3000 check weight 2
    server api2 192.168.1.21:3000 check weight 2
    server api3 192.168.1.22:3000 check weight 1

#------------------------------------------------------------------------------
# Static Content Backend
#------------------------------------------------------------------------------
backend static_servers
    mode http
    balance roundrobin
    
    # Compression
    compression algo gzip
    compression type text/html text/plain text/css application/javascript
    
    # Caching headers
    http-response set-header Cache-Control "public, max-age=2592000"
    
    server static1 192.168.1.30:80 check
    server static2 192.168.1.31:80 check

#------------------------------------------------------------------------------
# WebSocket Backend
#------------------------------------------------------------------------------
backend websocket_servers
    mode http
    balance source
    
    # WebSocket timeout (long-lived connections)
    timeout tunnel 3600s
    timeout server 3600s
    
    server ws1 192.168.1.40:8080 check
    server ws2 192.168.1.41:8080 check

#------------------------------------------------------------------------------
# Admin Backend
#------------------------------------------------------------------------------
backend admin_servers
    mode http
    balance roundrobin
    
    server admin1 192.168.1.50:8080 check</code></pre>
        </div>

        <h3>HAProxy ACLs and Conditionals</h3>
        <div class="code-block">
          <div class="code-header">
            <span class="code-lang">HAProxy</span>
            <span class="code-filename">Advanced ACL Examples</span>
            <button class="copy-btn">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="9" y="9" width="13" height="13" rx="2" ry="2"/><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"/></svg>
              Copy
            </button>
          </div>
          <pre><code># =============================================================================
# HAPROXY ACL EXAMPLES
# =============================================================================

frontend https_front
    bind *:443 ssl crt /etc/haproxy/certs/

    # ----- Path-based ACLs -----
    acl is_api path_beg /api/
    acl is_api_v2 path_beg /api/v2/
    acl is_static path_beg /static/ /assets/ /images/
    acl is_health path /health /healthz /ready
    
    # ----- Host-based ACLs -----
    acl host_api hdr(host) -i api.example.com
    acl host_www hdr(host) -i www.example.com example.com
    acl host_admin hdr(host) -i admin.example.com
    
    # ----- Source IP ACLs -----
    acl internal_network src 10.0.0.0/8 172.16.0.0/12 192.168.0.0/16
    acl trusted_ips src 203.0.113.0/24
    acl blocked_ips src -f /etc/haproxy/blocked_ips.txt
    
    # ----- Header-based ACLs -----
    acl is_websocket hdr(Upgrade) -i websocket
    acl is_ajax hdr(X-Requested-With) -i XMLHttpRequest
    acl has_auth_header hdr(Authorization) -m found
    acl is_bot hdr(User-Agent) -i -m sub bot crawler spider
    
    # ----- Method-based ACLs -----
    acl is_get method GET HEAD
    acl is_post method POST
    acl is_options method OPTIONS
    
    # ----- SSL/TLS ACLs -----
    acl is_ssl ssl_fc
    acl client_cert ssl_fc_has_crt
    
    # ----- Time-based ACLs -----
    acl maintenance_window time 2-3 00:00-06:00
    acl business_hours time 1-5 08:00-18:00
    
    # ----- Query parameter ACLs -----
    acl debug_mode url_param(debug) -m str true
    acl has_api_key url_param(api_key) -m found
    
    # ============= RULES =============
    
    # Block malicious IPs
    http-request deny if blocked_ips
    
    # Allow CORS preflight
    http-request allow if is_options
    
    # Rate limit non-authenticated requests
    http-request deny deny_status 429 if !has_auth_header { sc_http_req_rate(0) gt 50 }
    
    # Maintenance mode
    http-request deny deny_status 503 if maintenance_window !internal_network
    
    # Block bots from API
    http-request deny if is_api is_bot
    
    # Require SSL for admin
    http-request redirect scheme https if host_admin !is_ssl
    
    # Routing based on ACLs
    use_backend api_v2_servers if is_api_v2
    use_backend api_servers if is_api OR host_api
    use_backend admin_servers if host_admin internal_network
    use_backend static_servers if is_static
    use_backend websocket_servers if is_websocket
    
    default_backend web_servers</code></pre>
        </div>
      </section>

      <!-- Apache -->
      <section>
        <h2 id="apache">Apache mod_proxy</h2>
        <p>
          Apache HTTP Server can function as a reverse proxy using mod_proxy and related modules.
        </p>

        <div class="code-block">
          <div class="code-header">
            <span class="code-lang">Apache</span>
            <span class="code-filename">/etc/apache2/sites-available/app.conf</span>
            <button class="copy-btn">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="9" y="9" width="13" height="13" rx="2" ry="2"/><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"/></svg>
              Copy
            </button>
          </div>
          <pre><code># =============================================================================
# APACHE REVERSE PROXY CONFIGURATION
# =============================================================================

# Enable required modules:
# a2enmod proxy proxy_http proxy_balancer lbmethod_byrequests ssl headers

<VirtualHost *:80>
    ServerName app.example.com
    Redirect permanent / https://app.example.com/
</VirtualHost>

<VirtualHost *:443>
    ServerName app.example.com
    
    # SSL Configuration
    SSLEngine on
    SSLCertificateFile /etc/ssl/certs/app.example.com.crt
    SSLCertificateKeyFile /etc/ssl/private/app.example.com.key
    SSLProtocol all -SSLv3 -TLSv1 -TLSv1.1
    SSLCipherSuite ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES128-GCM-SHA256
    
    # Security Headers
    Header always set X-Frame-Options "SAMEORIGIN"
    Header always set X-Content-Type-Options "nosniff"
    Header always set X-XSS-Protection "1; mode=block"
    Header always set Strict-Transport-Security "max-age=31536000; includeSubDomains"
    
    # Proxy settings
    ProxyPreserveHost On
    ProxyRequests Off
    
    # Backend balancer
    <Proxy "balancer://webcluster">
        BalancerMember "http://192.168.1.10:8080" loadfactor=3
        BalancerMember "http://192.168.1.11:8080" loadfactor=2
        BalancerMember "http://192.168.1.12:8080" loadfactor=1
        ProxySet lbmethod=byrequests
        ProxySet stickysession=JSESSIONID
    </Proxy>
    
    # API backend
    <Proxy "balancer://apicluster">
        BalancerMember "http://192.168.1.20:3000"
        BalancerMember "http://192.168.1.21:3000"
        ProxySet lbmethod=bybusyness
    </Proxy>
    
    # Proxy rules
    ProxyPass "/api/" "balancer://apicluster/"
    ProxyPassReverse "/api/" "balancer://apicluster/"
    
    ProxyPass "/" "balancer://webcluster/"
    ProxyPassReverse "/" "balancer://webcluster/"
    
    # WebSocket support
    RewriteEngine On
    RewriteCond %{HTTP:Upgrade} websocket [NC]
    RewriteCond %{HTTP:Connection} upgrade [NC]
    RewriteRule ^/?(.*) "ws://192.168.1.40:8080/$1" [P,L]
    
    # Logging
    ErrorLog ${APACHE_LOG_DIR}/app_error.log
    CustomLog ${APACHE_LOG_DIR}/app_access.log combined
</VirtualHost>

# Balancer manager (for debugging)
<Location "/balancer-manager">
    SetHandler balancer-manager
    Require ip 192.168.1.0/24
</Location></code></pre>
        </div>
      </section>

      <!-- Traefik -->
      <section>
        <h2 id="traefik">Traefik</h2>
        <p>
          Traefik is a modern reverse proxy and load balancer designed for microservices 
          and container environments with automatic service discovery.
        </p>

        <div class="code-block">
          <div class="code-header">
            <span class="code-lang">YAML</span>
            <span class="code-filename">traefik.yml - Static Configuration</span>
            <button class="copy-btn">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="9" y="9" width="13" height="13" rx="2" ry="2"/><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"/></svg>
              Copy
            </button>
          </div>
          <pre><code># =============================================================================
# TRAEFIK STATIC CONFIGURATION
# =============================================================================

# API and Dashboard
api:
  dashboard: true
  insecure: false

# Entry Points
entryPoints:
  web:
    address: ":80"
    http:
      redirections:
        entryPoint:
          to: websecure
          scheme: https
  
  websecure:
    address: ":443"
    http:
      tls:
        certResolver: letsencrypt

# Certificate Resolvers
certificatesResolvers:
  letsencrypt:
    acme:
      email: admin@example.com
      storage: /etc/traefik/acme.json
      httpChallenge:
        entryPoint: web

# Providers
providers:
  docker:
    endpoint: "unix:///var/run/docker.sock"
    exposedByDefault: false
    network: traefik-net
  
  file:
    directory: /etc/traefik/dynamic/
    watch: true

# Logging
log:
  level: INFO
  filePath: /var/log/traefik/traefik.log

accessLog:
  filePath: /var/log/traefik/access.log
  format: json</code></pre>
        </div>

        <div class="code-block">
          <div class="code-header">
            <span class="code-lang">YAML</span>
            <span class="code-filename">dynamic/services.yml</span>
            <button class="copy-btn">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="9" y="9" width="13" height="13" rx="2" ry="2"/><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"/></svg>
              Copy
            </button>
          </div>
          <pre><code># =============================================================================
# TRAEFIK DYNAMIC CONFIGURATION
# =============================================================================

http:
  # Routers
  routers:
    web-router:
      rule: "Host(`app.example.com`)"
      entryPoints:
        - websecure
      service: web-service
      middlewares:
        - security-headers
        - rate-limit
      tls:
        certResolver: letsencrypt
    
    api-router:
      rule: "Host(`app.example.com`) && PathPrefix(`/api/`)"
      entryPoints:
        - websecure
      service: api-service
      middlewares:
        - api-stripprefix
        - rate-limit
      tls:
        certResolver: letsencrypt

  # Services
  services:
    web-service:
      loadBalancer:
        servers:
          - url: "http://192.168.1.10:8080"
          - url: "http://192.168.1.11:8080"
          - url: "http://192.168.1.12:8080"
        healthCheck:
          path: /health
          interval: "10s"
          timeout: "3s"
    
    api-service:
      loadBalancer:
        servers:
          - url: "http://192.168.1.20:3000"
          - url: "http://192.168.1.21:3000"
        sticky:
          cookie:
            name: api_session
            secure: true

  # Middlewares
  middlewares:
    security-headers:
      headers:
        frameDeny: true
        contentTypeNosniff: true
        browserXssFilter: true
        stsSeconds: 31536000
        stsIncludeSubdomains: true
    
    rate-limit:
      rateLimit:
        average: 100
        burst: 50
    
    api-stripprefix:
      stripPrefix:
        prefixes:
          - "/api"</code></pre>
        </div>
      </section>

      <!-- Comparison -->
      <section>
        <h2 id="comparison">Reverse Proxy Comparison</h2>

        <div class="table-wrapper">
          <table class="comparison-table">
            <thead>
              <tr>
                <th>Feature</th>
                <th>Nginx</th>
                <th>HAProxy</th>
                <th>Apache</th>
                <th>Traefik</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td><strong>Performance</strong></td>
                <td><span class="feature-yes">Excellent</span></td>
                <td><span class="feature-yes">Excellent</span></td>
                <td><span class="feature-partial">Good</span></td>
                <td><span class="feature-yes">Very Good</span></td>
              </tr>
              <tr>
                <td><strong>Configuration</strong></td>
                <td>File-based</td>
                <td>File-based</td>
                <td>File-based</td>
                <td>Dynamic/File</td>
              </tr>
              <tr>
                <td><strong>Service Discovery</strong></td>
                <td>Manual/DNS</td>
                <td>Manual/DNS</td>
                <td>Manual</td>
                <td><span class="feature-yes">Automatic</span></td>
              </tr>
              <tr>
                <td><strong>Container Support</strong></td>
                <td>Good</td>
                <td>Good</td>
                <td>Basic</td>
                <td><span class="feature-yes">Native</span></td>
              </tr>
              <tr>
                <td><strong>SSL Termination</strong></td>
                <td><span class="feature-yes">Yes</span></td>
                <td><span class="feature-yes">Yes</span></td>
                <td><span class="feature-yes">Yes</span></td>
                <td><span class="feature-yes">Yes + Auto</span></td>
              </tr>
              <tr>
                <td><strong>WebSocket</strong></td>
                <td><span class="feature-yes">Yes</span></td>
                <td><span class="feature-yes">Yes</span></td>
                <td><span class="feature-yes">Yes</span></td>
                <td><span class="feature-yes">Yes</span></td>
              </tr>
              <tr>
                <td><strong>Best For</strong></td>
                <td>Web serving + Proxy</td>
                <td>Pure load balancing</td>
                <td>Legacy/Compatibility</td>
                <td>Microservices/K8s</td>
              </tr>
            </tbody>
          </table>
        </div>
      </section>

      <!-- Next Steps -->
      <section>
        <div class="section-divider"><span>Continue Learning</span></div>
        
        <div class="card-grid">
          <a href="load-balancing.html" class="nav-card card">
            <h4>Load Balancing →</h4>
            <p>Deep dive into load balancing algorithms and patterns.</p>
          </a>
          <a href="waf.html" class="nav-card card">
            <h4>Web Application Firewall →</h4>
            <p>Protect applications with WAF technologies.</p>
          </a>
          <a href="firewall-concepts.html" class="nav-card card">
            <h4>Firewall Concepts →</h4>
            <p>Understand firewall fundamentals and architectures.</p>
          </a>
        </div>
      </section>

    </div>
  </main>

  <footer class="footer">
    <div class="footer-bottom">
      <p>Network Security & Infrastructure Guide</p>
    </div>
  </footer>

  <script src="main.js"></script>
</body>
</html>
