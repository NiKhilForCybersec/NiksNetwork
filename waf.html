<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="Web Application Firewall Guide - Understanding WAF concepts, deployment strategies, and tuning methodology">
  <title>WAF Guide | NetSec Guide</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <nav class="navbar">
    <a href="index.html" class="navbar-brand">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/>
      </svg>
      NetSec Guide
    </a>
    <ul class="navbar-nav">
      <li><a href="index.html">Home</a></li>
      <li><a href="network-fundamentals.html">Fundamentals</a></li>
      <li><a href="forward-proxy.html">Proxies</a></li>
      <li><a href="firewall-concepts.html">Firewalls</a></li>
      <li><a href="troubleshooting.html">Troubleshooting</a></li>
    </ul>
    <button class="menu-toggle" aria-label="Toggle menu">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <line x1="3" y1="12" x2="21" y2="12"></line>
        <line x1="3" y1="6" x2="21" y2="6"></line>
        <line x1="3" y1="18" x2="21" y2="18"></line>
      </svg>
    </button>
  </nav>

  <aside class="sidebar">
    <div class="sidebar-section">
      <div class="sidebar-title">On This Page</div>
      <ul class="sidebar-nav">
        <li><a href="#what">What is WAF</a></li>
        <li><a href="#when">When to Use WAF</a></li>
        <li><a href="#deployment">Deployment Process</a></li>
        <li><a href="#tuning">Tuning Methodology</a></li>
        <li><a href="#solutions">WAF Solutions</a></li>
        <li><a href="#gotchas">Common Gotchas</a></li>
      </ul>
    </div>
    <div class="sidebar-section">
      <div class="sidebar-title">Related Pages</div>
      <ul class="sidebar-nav">
        <li><a href="reverse-proxy.html">Reverse Proxy</a></li>
        <li><a href="load-balancing.html">Load Balancing</a></li>
        <li><a href="ids-ips.html">IDS/IPS</a></li>
      </ul>
    </div>
  </aside>

  <main class="main-content">
    <div class="content-wrapper">
      <nav class="breadcrumb">
        <span class="breadcrumb-item"><a href="index.html">Home</a></span>
        <span class="breadcrumb-separator">/</span>
        <span class="breadcrumb-item active">Web Application Firewall</span>
      </nav>

      <h1>Web Application Firewall (WAF)</h1>
      <p class="hero-subtitle">
        Understanding WAF concepts, choosing the right solution, and implementing 
        effectively without breaking your applications.
      </p>

      <!-- What is WAF -->
      <section>
        <h2 id="what">What is a WAF?</h2>
        <p>
          A Web Application Firewall inspects HTTP/HTTPS traffic and blocks malicious requests 
          before they reach your application. Unlike network firewalls that work at layers 3-4, 
          WAF operates at layer 7 and understands application protocols.
        </p>

        <div class="ascii-diagram">
          <div class="ascii-diagram-title">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="3" width="18" height="18" rx="2"/></svg>
            WAF in the Request Flow
          </div>
          <pre>
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        WHERE WAF SITS                                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                             â”‚
â”‚   User Request                                                              â”‚
â”‚        â”‚                                                                    â”‚
â”‚        â–¼                                                                    â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â”‚
â”‚   â”‚   CDN   â”‚â”€â”€â”€â”€â–ºâ”‚   WAF   â”‚â”€â”€â”€â”€â–ºâ”‚  Load   â”‚â”€â”€â”€â”€â–ºâ”‚   App   â”‚             â”‚
â”‚   â”‚ (Edge)  â”‚     â”‚         â”‚     â”‚Balancer â”‚     â”‚ Server  â”‚             â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â”‚
â”‚                        â”‚                                                    â”‚
â”‚                        â”‚ Inspects:                                          â”‚
â”‚                        â”‚ â€¢ URL and query strings                            â”‚
â”‚                        â”‚ â€¢ HTTP headers                                     â”‚
â”‚                        â”‚ â€¢ POST body / JSON                                 â”‚
â”‚                        â”‚ â€¢ Cookies                                          â”‚
â”‚                        â”‚ â€¢ File uploads                                     â”‚
â”‚                        â”‚                                                    â”‚
â”‚                        â”‚ Decides:                                           â”‚
â”‚                        â”‚ âœ“ ALLOW - Clean request                           â”‚
â”‚                        â”‚ âœ— BLOCK - Attack detected                         â”‚
â”‚                        â”‚ ? LOG   - Suspicious, monitor                     â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          </pre>
        </div>

        <h3>What WAF Protects Against</h3>
        <div class="table-wrapper">
          <table>
            <thead>
              <tr>
                <th>Attack Type</th>
                <th>What It Looks Like</th>
                <th>WAF Detection</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td><strong>SQL Injection</strong></td>
                <td><code>' OR '1'='1</code> in form fields</td>
                <td>Pattern matching on SQL keywords</td>
              </tr>
              <tr>
                <td><strong>XSS</strong></td>
                <td><code>&lt;script&gt;alert()&lt;/script&gt;</code></td>
                <td>HTML/JS pattern detection</td>
              </tr>
              <tr>
                <td><strong>Path Traversal</strong></td>
                <td><code>../../etc/passwd</code></td>
                <td>Directory traversal patterns</td>
              </tr>
              <tr>
                <td><strong>Command Injection</strong></td>
                <td><code>; cat /etc/passwd</code></td>
                <td>Shell command patterns</td>
              </tr>
              <tr>
                <td><strong>Bot Attacks</strong></td>
                <td>Credential stuffing, scraping</td>
                <td>Rate limiting, bot signatures</td>
              </tr>
            </tbody>
          </table>
        </div>

        <div class="callout callout-warning">
          <strong>WAF is Not a Silver Bullet</strong><br>
          WAF is defense-in-depth, not a replacement for secure code. It catches common attacks 
          but cannot protect against business logic flaws or zero-day vulnerabilities in your specific application.
        </div>
      </section>

      <!-- When to Use -->
      <section>
        <h2 id="when">When to Use WAF</h2>

        <div class="ascii-diagram">
          <div class="ascii-diagram-title">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="3" width="18" height="18" rx="2"/></svg>
            Decision Framework: Do You Need WAF?
          </div>
          <pre>
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     DO YOU NEED A WAF?                                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                             â”‚
â”‚   START HERE                                                                â”‚
â”‚       â”‚                                                                     â”‚
â”‚       â–¼                                                                     â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                        â”‚
â”‚   â”‚ Is it a web application       â”‚                                        â”‚
â”‚   â”‚ exposed to the internet?      â”‚                                        â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                        â”‚
â”‚                   â”‚                                                         â”‚
â”‚          â”Œâ”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”                                                 â”‚
â”‚          â”‚               â”‚                                                 â”‚
â”‚         YES              NO â”€â”€â”€â”€â”€â”€â–º WAF not needed                         â”‚
â”‚          â”‚                         (internal apps may use                  â”‚
â”‚          â–¼                          different controls)                    â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                        â”‚
â”‚   â”‚ Does it handle sensitive data â”‚                                        â”‚
â”‚   â”‚ (PCI, PHI, PII, auth)?        â”‚                                        â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                        â”‚
â”‚                   â”‚                                                         â”‚
â”‚          â”Œâ”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”                                                 â”‚
â”‚          â”‚               â”‚                                                 â”‚
â”‚         YES              NO                                                â”‚
â”‚          â”‚               â”‚                                                 â”‚
â”‚          â–¼               â–¼                                                 â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                         â”‚
â”‚   â”‚ WAF is      â”‚  â”‚ Is it a high-traffic or     â”‚                         â”‚
â”‚   â”‚ REQUIRED    â”‚  â”‚ high-value target?          â”‚                         â”‚
â”‚   â”‚             â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                         â”‚
â”‚   â”‚ â€¢ PCI DSS   â”‚                 â”‚                                        â”‚
â”‚   â”‚ â€¢ HIPAA     â”‚        â”Œâ”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”                                â”‚
â”‚   â”‚ â€¢ SOC 2     â”‚        â”‚               â”‚                                â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       YES              NO                               â”‚
â”‚                          â”‚               â”‚                                 â”‚
â”‚                          â–¼               â–¼                                 â”‚
â”‚                   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                         â”‚
â”‚                   â”‚ WAF         â”‚  â”‚ WAF is      â”‚                         â”‚
â”‚                   â”‚ RECOMMENDED â”‚  â”‚ OPTIONAL    â”‚                         â”‚
â”‚                   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                         â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          </pre>
        </div>

        <h3>Choose Your WAF Type</h3>
        <div class="table-wrapper">
          <table>
            <thead>
              <tr>
                <th>Type</th>
                <th>Best For</th>
                <th>Examples</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td><strong>Cloud WAF (CDN)</strong></td>
                <td>Quick deployment, DDoS protection, global apps</td>
                <td>Cloudflare, AWS WAF, Azure Front Door</td>
              </tr>
              <tr>
                <td><strong>Cloud WAF (LB-integrated)</strong></td>
                <td>Already using cloud load balancers</td>
                <td>AWS WAF on ALB, Azure WAF on App Gateway</td>
              </tr>
              <tr>
                <td><strong>On-Prem Appliance</strong></td>
                <td>Data sovereignty, existing infrastructure</td>
                <td>F5 ASM, Imperva, Fortinet FortiWeb</td>
              </tr>
              <tr>
                <td><strong>Open Source (Embedded)</strong></td>
                <td>Budget constraints, full control</td>
                <td>ModSecurity, Coraza</td>
              </tr>
            </tbody>
          </table>
        </div>
      </section>

      <!-- Deployment Process -->
      <section>
        <h2 id="deployment">WAF Deployment Process</h2>
        <p>
          The key to successful WAF deployment is <strong>starting in detection mode</strong>. 
          Never deploy blocking rules to production without understanding your traffic first.
        </p>

        <div class="ascii-diagram">
          <div class="ascii-diagram-title">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="3" width="18" height="18" rx="2"/></svg>
            WAF Deployment Phases
          </div>
          <pre>
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    WAF DEPLOYMENT METHODOLOGY                               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                             â”‚
â”‚   PHASE 1: DETECTION MODE (2-4 weeks)                                      â”‚
â”‚   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•                                      â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚   â”‚  â€¢ Deploy WAF with logging only (no blocking)                       â”‚  â”‚
â”‚   â”‚  â€¢ Enable all rule categories                                       â”‚  â”‚
â”‚   â”‚  â€¢ Let it observe normal traffic patterns                           â”‚  â”‚
â”‚   â”‚  â€¢ Collect baseline of what triggers alerts                         â”‚  â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                              â”‚                                              â”‚
â”‚                              â–¼                                              â”‚
â”‚   PHASE 2: ANALYZE & TUNE (1-2 weeks)                                      â”‚
â”‚   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•                                      â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚   â”‚  â€¢ Review logs: What's triggering rules?                            â”‚  â”‚
â”‚   â”‚  â€¢ Identify false positives:                                        â”‚  â”‚
â”‚   â”‚    - Legitimate API calls flagged as attacks                        â”‚  â”‚
â”‚   â”‚    - Rich text editors triggering XSS rules                         â”‚  â”‚
â”‚   â”‚    - File uploads triggering malware rules                          â”‚  â”‚
â”‚   â”‚  â€¢ Create exclusions for known-good patterns                        â”‚  â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                              â”‚                                              â”‚
â”‚                              â–¼                                              â”‚
â”‚   PHASE 3: STAGED BLOCKING                                                 â”‚
â”‚   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•                                              â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚   â”‚  â€¢ Enable blocking for HIGH confidence rules first                  â”‚  â”‚
â”‚   â”‚    (obvious SQL injection, known malware signatures)                â”‚  â”‚
â”‚   â”‚  â€¢ Keep MEDIUM confidence rules in detection                        â”‚  â”‚
â”‚   â”‚  â€¢ Monitor for blocked legitimate traffic                           â”‚  â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                              â”‚                                              â”‚
â”‚                              â–¼                                              â”‚
â”‚   PHASE 4: FULL PROTECTION                                                 â”‚
â”‚   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•                                              â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚   â”‚  â€¢ Enable blocking for remaining rules                              â”‚  â”‚
â”‚   â”‚  â€¢ Set up alerting for blocked requests                             â”‚  â”‚
â”‚   â”‚  â€¢ Establish ongoing tuning process                                 â”‚  â”‚
â”‚   â”‚  â€¢ Document all exclusions with business justification              â”‚  â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                             â”‚
â”‚   âš ï¸  NEVER SKIP TO PHASE 4 - You WILL break legitimate traffic          â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          </pre>
        </div>
      </section>

      <!-- Tuning Methodology -->
      <section>
        <h2 id="tuning">Tuning Methodology</h2>
        <p>
          False positives are inevitable. The goal is to create targeted exclusions 
          without weakening your overall security posture.
        </p>

        <h3>The Exclusion Hierarchy</h3>
        <p>Always use the most specific exclusion possible:</p>

        <div class="code-block">
          <div class="code-header">
            <span class="code-lang">Concept</span>
            <span class="code-filename">Exclusion Specificity (Best to Worst)</span>
            <button class="copy-btn">Copy</button>
          </div>
          <pre><code># MOST SPECIFIC (Best) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# Exclude specific parameter from specific rule on specific URL
URL: /api/comments
Parameter: message_body
Rule: XSS-941100

# MODERATELY SPECIFIC â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# Exclude specific parameter from rule category site-wide
Parameter: html_content
Rules: All XSS rules (941xxx)

# LESS SPECIFIC â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# Exclude entire URL path from inspection
URL: /api/webhook/*
Rules: All rules

# LEAST SPECIFIC (Avoid) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# Disable entire rule category globally
Rules: Disable all XSS rules
âŒ This defeats the purpose of WAF</code></pre>
        </div>

        <h3>Common False Positive Scenarios</h3>
        <div class="accordion">
          <div class="accordion-item">
            <button class="accordion-header">
              Rich Text Editors / HTML Content
              <svg class="accordion-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="6 9 12 15 18 9"/></svg>
            </button>
            <div class="accordion-body">
              <p><strong>Problem:</strong> WYSIWYG editors submit HTML that triggers XSS rules.</p>
              <p><strong>Solution:</strong> Exclude the specific form field from XSS rules, not the entire endpoint.</p>
              <div class="code-block">
                <div class="code-header"><span class="code-lang">ModSecurity</span><button class="copy-btn">Copy</button></div>
                <pre><code># Exclude 'content' parameter from XSS rules only
SecRuleUpdateTargetById 941100-941999 "!ARGS:content"</code></pre>
              </div>
            </div>
          </div>

          <div class="accordion-item">
            <button class="accordion-header">
              JSON APIs with Special Characters
              <svg class="accordion-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="6 9 12 15 18 9"/></svg>
            </button>
            <div class="accordion-body">
              <p><strong>Problem:</strong> API payloads with code samples or encoded data trigger injection rules.</p>
              <p><strong>Solution:</strong> Exclude by Content-Type header, keeping form submissions protected.</p>
              <div class="code-block">
                <div class="code-header"><span class="code-lang">Concept</span><button class="copy-btn">Copy</button></div>
                <pre><code># For application/json requests to /api/* endpoints:
# - Reduce sensitivity for SQL/XSS rules
# - Keep rate limiting and bot protection active</code></pre>
              </div>
            </div>
          </div>

          <div class="accordion-item">
            <button class="accordion-header">
              File Upload Endpoints
              <svg class="accordion-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="6 9 12 15 18 9"/></svg>
            </button>
            <div class="accordion-body">
              <p><strong>Problem:</strong> Legitimate file uploads trigger malware/size rules.</p>
              <p><strong>Solution:</strong> Create specific policy for upload endpoints with appropriate limits.</p>
              <div class="code-block">
                <div class="code-header"><span class="code-lang">Concept</span><button class="copy-btn">Copy</button></div>
                <pre><code># For /upload endpoints:
# - Increase body size limit (e.g., 100MB)
# - Disable body inspection (can't parse binary)
# - Keep other protections (SQL injection in filename, etc.)</code></pre>
              </div>
            </div>
          </div>

          <div class="accordion-item">
            <button class="accordion-header">
              Webhooks from Third Parties
              <svg class="accordion-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="6 9 12 15 18 9"/></svg>
            </button>
            <div class="accordion-body">
              <p><strong>Problem:</strong> Payment providers, CRMs send callbacks that trigger rules.</p>
              <p><strong>Solution:</strong> Whitelist by source IP AND path, verify webhook signatures in your app.</p>
              <div class="code-block">
                <div class="code-header"><span class="code-lang">Concept</span><button class="copy-btn">Copy</button></div>
                <pre><code># For /webhooks/stripe:
# - Allow from Stripe IP ranges only
# - Reduce WAF inspection (Stripe validates their payloads)
# - Your app should verify webhook signatures anyway</code></pre>
              </div>
            </div>
          </div>
        </div>
      </section>

      <!-- Solutions Overview -->
      <section>
        <h2 id="solutions">WAF Solutions Overview</h2>

        <h3>Cloud WAF Quick Comparison</h3>
        <div class="table-wrapper">
          <table>
            <thead>
              <tr>
                <th>Solution</th>
                <th>Strengths</th>
                <th>Considerations</th>
                <th>Pricing Model</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td><strong>Cloudflare</strong></td>
                <td>Easy setup, great free tier, DDoS included</td>
                <td>Must proxy through Cloudflare</td>
                <td>Per site/month + request volume</td>
              </tr>
              <tr>
                <td><strong>AWS WAF</strong></td>
                <td>Native AWS integration, pay-per-use</td>
                <td>Requires AWS infrastructure</td>
                <td>Per rule + per million requests</td>
              </tr>
              <tr>
                <td><strong>Azure WAF</strong></td>
                <td>Native Azure integration, managed rules</td>
                <td>Requires Azure App Gateway/Front Door</td>
                <td>Per gateway hour + data processed</td>
              </tr>
              <tr>
                <td><strong>ModSecurity</strong></td>
                <td>Free, open source, full control</td>
                <td>Requires expertise to tune</td>
                <td>Free (self-managed)</td>
              </tr>
            </tbody>
          </table>
        </div>

        <h3>Minimal Configuration Examples</h3>
        <p>
          These examples show the essential pattern. Each vendor has extensive documentation 
          for additional options.
        </p>

        <div class="tabs">
          <div class="tab-list">
            <button class="tab-btn active" data-tab="aws-waf">AWS WAF</button>
            <button class="tab-btn" data-tab="cloudflare">Cloudflare</button>
            <button class="tab-btn" data-tab="modsec">ModSecurity</button>
          </div>

          <div class="tab-content active" id="aws-waf">
            <div class="code-block">
              <div class="code-header">
                <span class="code-lang">Terraform</span>
                <span class="code-filename">AWS WAF - Essential Pattern</span>
                <button class="copy-btn">Copy</button>
              </div>
              <pre><code># AWS WAF - The essential building blocks
# Full reference: docs.aws.amazon.com/waf/

resource "aws_wafv2_web_acl" "main" {
  name  = "my-app-waf"
  scope = "REGIONAL"          # Use CLOUDFRONT for CDN

  default_action { allow {} } # Allow unless blocked

  # 1. AWS Managed Rules (recommended starting point)
  rule {
    name     = "AWS-CommonRules"
    priority = 1
    override_action { none {} }  # Use managed rule actions

    statement {
      managed_rule_group_statement {
        vendor_name = "AWS"
        name        = "AWSManagedRulesCommonRuleSet"
      }
    }
    visibility_config {
      sampled_requests_enabled   = true
      cloudwatch_metrics_enabled = true
      metric_name               = "CommonRules"
    }
  }

  # 2. Rate limiting (add your own rules like this)
  rule {
    name     = "RateLimit"
    priority = 2
    action { block {} }

    statement {
      rate_based_statement {
        limit              = 2000  # Per 5 minutes per IP
        aggregate_key_type = "IP"
      }
    }
    visibility_config {
      sampled_requests_enabled   = true
      cloudwatch_metrics_enabled = true
      metric_name               = "RateLimit"
    }
  }

  visibility_config {
    cloudwatch_metrics_enabled = true
    sampled_requests_enabled   = true
    metric_name               = "my-app-waf"
  }
}

# Attach to ALB
resource "aws_wafv2_web_acl_association" "main" {
  resource_arn = aws_lb.main.arn
  web_acl_arn  = aws_wafv2_web_acl.main.arn
}</code></pre>
            </div>
            <p><strong>AWS Managed Rule Groups:</strong> CommonRuleSet, SQLiRuleSet, KnownBadInputsRuleSet, LinuxRuleSet, WindowsRuleSet, PHPRuleSet, WordPressRuleSet. Add these following the same pattern above.</p>
          </div>

          <div class="tab-content" id="cloudflare">
            <div class="code-block">
              <div class="code-header">
                <span class="code-lang">Dashboard Steps</span>
                <span class="code-filename">Cloudflare WAF - Quick Setup</span>
                <button class="copy-btn">Copy</button>
              </div>
              <pre><code># Cloudflare WAF - Simplest setup via Dashboard
# Full reference: developers.cloudflare.com/waf/

STEP 1: Enable Managed Rulesets
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Security â†’ WAF â†’ Managed rules
â€¢ Enable "Cloudflare Managed Ruleset"
â€¢ Enable "OWASP Core Ruleset"
â€¢ Set to LOG initially, switch to BLOCK after testing

STEP 2: Configure Security Level
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Security â†’ Settings
â€¢ Security Level: Medium (start here)
â€¢ Challenge Passage: 30 minutes
â€¢ Browser Integrity Check: ON

STEP 3: Add Rate Limiting (if needed)
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Security â†’ WAF â†’ Rate limiting rules
â€¢ Create rule for /login: 5 requests per minute
â€¢ Action: Block for 10 minutes

STEP 4: Monitor
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Security â†’ Events
â€¢ Review blocked/challenged requests
â€¢ Create exceptions for false positives</code></pre>
            </div>
          </div>

          <div class="tab-content" id="modsec">
            <div class="code-block">
              <div class="code-header">
                <span class="code-lang">Apache Config</span>
                <span class="code-filename">ModSecurity - Essential Setup</span>
                <button class="copy-btn">Copy</button>
              </div>
              <pre><code># ModSecurity - The essential configuration
# Full reference: github.com/coreruleset/coreruleset

# /etc/modsecurity/modsecurity.conf

# Start in DETECTION mode - change to On after tuning
SecRuleEngine DetectionOnly

# Essential settings
SecRequestBodyAccess On
SecResponseBodyAccess Off          # Usually not needed
SecRequestBodyLimit 13107200       # 12.5MB
SecAuditEngine RelevantOnly        # Log suspicious only
SecAuditLog /var/log/modsec_audit.log

# Load OWASP Core Rule Set
Include /etc/modsecurity/coreruleset/crs-setup.conf
Include /etc/modsecurity/coreruleset/rules/*.conf

# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# YOUR EXCLUSIONS GO HERE (after CRS includes)
# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

# Example: Exclude parameter from XSS rules
SecRuleUpdateTargetById 941100-941999 "!ARGS:html_content"

# Example: Whitelist internal monitoring
SecRule REMOTE_ADDR "@ipMatch 10.0.0.0/8" \
    "id:1000,phase:1,pass,nolog,ctl:ruleEngine=Off"</code></pre>
            </div>
            <p><strong>Tip:</strong> Use OWASP CRS Paranoia Level 1 initially. Higher levels catch more but have more false positives.</p>
          </div>
        </div>
      </section>

      <!-- Gotchas -->
      <section>
        <h2 id="gotchas">Common Gotchas</h2>

        <div class="card-grid">
          <div class="card">
            <h4>ğŸš« Deploying in Blocking Mode</h4>
            <p>Always start in detection/log-only mode. Even "safe" rules can break legitimate traffic.</p>
          </div>
          <div class="card">
            <h4>ğŸš« Disabling Rules Globally</h4>
            <p>Create specific exclusions for affected endpoints instead of disabling rules everywhere.</p>
          </div>
          <div class="card">
            <h4>ğŸš« Ignoring Performance</h4>
            <p>WAF adds 5-50ms latency. Test under load and size infrastructure accordingly.</p>
          </div>
          <div class="card">
            <h4>ğŸš« Set and Forget</h4>
            <p>Apps change. Review WAF logs monthly and update exclusions as your app evolves.</p>
          </div>
          <div class="card">
            <h4>ğŸš« No Bypass Plan</h4>
            <p>Have a documented procedure to quickly disable WAF if it causes issues. Test it.</p>
          </div>
          <div class="card">
            <h4>ğŸš« Not Logging Enough</h4>
            <p>Log blocked AND allowed requests initially. You need this for tuning and investigations.</p>
          </div>
        </div>
      </section>

      <!-- Quick Reference -->
      <section>
        <h2>Quick Reference</h2>
        <div class="code-block">
          <div class="code-header">
            <span class="code-lang">Checklist</span>
            <span class="code-filename">WAF Deployment Checklist</span>
            <button class="copy-btn">Copy</button>
          </div>
          <pre><code>WAF DEPLOYMENT CHECKLIST
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

PRE-DEPLOYMENT
â–¡ Identify all endpoints and expected traffic patterns
â–¡ Document legitimate patterns that might trigger rules
â–¡ Choose WAF solution based on infrastructure
â–¡ Plan detection mode duration (minimum 2 weeks)

DEPLOYMENT
â–¡ Deploy in DETECTION/LOG-ONLY mode
â–¡ Enable comprehensive logging
â–¡ Set up dashboards for rule trigger frequency

TUNING (After 2+ weeks)
â–¡ Review top triggered rules
â–¡ Categorize: True attack vs False positive
â–¡ Create SPECIFIC exclusions for false positives
â–¡ Document each exclusion with justification

STAGED ROLLOUT
â–¡ Enable blocking for high-confidence rules first
â–¡ Monitor for blocked legitimate traffic
â–¡ Gradually enable remaining rules

ONGOING
â–¡ Monthly log review
â–¡ Update exclusions when application changes
â–¡ Test bypass procedure quarterly</code></pre>
        </div>
      </section>

      <section>
        <div class="section-divider"><span>Related Guides</span></div>
        <div class="card-grid">
          <a href="reverse-proxy.html" class="nav-card card">
            <h4>Reverse Proxy â†’</h4>
            <p>Nginx, HAProxy as WAF front-ends.</p>
          </a>
          <a href="ids-ips.html" class="nav-card card">
            <h4>IDS/IPS â†’</h4>
            <p>Network-level intrusion detection.</p>
          </a>
          <a href="best-practices.html" class="nav-card card">
            <h4>Best Practices â†’</h4>
            <p>Security hardening guidelines.</p>
          </a>
        </div>
      </section>

    </div>
  </main>

  <footer class="footer">
    <div class="footer-bottom">
      <p>Network Security & Infrastructure Guide</p>
    </div>
  </footer>

  <script src="main.js"></script>
</body>
</html>
